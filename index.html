<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LunX Studio - AI Architect Edition</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>

    <style>
        :root { --primary: #d32f2f; --bg-ui: #fff; }
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; touch-action: none; font-family: 'Segoe UI', sans-serif; outline: none; }
        body { margin: 0; overflow: hidden; background: #f0f0f0; height: 100vh; display: flex; flex-direction: column; }

        /* UI STYLES */
        #start-screen {
            position: fixed; inset: 0; background: linear-gradient(135deg, #d32f2f, #ff8a80);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        .template-card {
            background: white; color: #333; width: 140px; height: 160px; border-radius: 10px; margin: 10px;
            display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .template-card:hover { transform: translateY(-5px); }

        #top-bar { height: 45px; background: var(--primary); color: white; display: flex; align-items: center; padding: 0 10px; }
        #ribbon { height: 90px; background: white; border-bottom: 1px solid #ddd; display: flex; overflow-x: auto; }
        .tool-btn { display: flex; flex-direction: column; align-items: center; min-width: 60px; cursor: pointer; font-size: 11px; color: #444; padding: 5px; }
        .tool-btn:hover { background: #ffebee; }
        .tool-btn.active { background: #ffCDD2; border: 1px solid var(--primary); border-radius: 4px; }

        #layout { flex: 1; display: flex; position: relative; overflow: hidden; }
        #toolbox { width: 240px; background: white; border-right: 1px solid #ddd; display: none; flex-direction: column; z-index: 20; }
        #viewport { flex: 1; position: relative; background: #87CEEB; overflow: hidden; }
        #properties { width: 240px; background: white; border-left: 1px solid #ddd; display: flex; flex-direction: column; z-index: 20; }

        /* TOOLBOX TABS */
        .tb-tabs { display: flex; border-bottom: 1px solid #ccc; background: #f5f5f5; }
        .tb-tab { flex: 1; padding: 8px; text-align: center; font-size: 12px; cursor: pointer; }
        .tb-tab.active { background: white; font-weight: bold; border-bottom: 2px solid var(--primary); }
        .tb-content { display: none; padding: 5px; overflow-y: auto; flex: 1; }
        .tb-content.active { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; align-content: start; }

        /* GAME HUD */
        #game-hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 100; }
        #joystick-zone { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid rgba(255,255,255,0.5); pointer-events: auto; }
        #stick { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: white; border-radius: 50%; transform: translate(-50%,-50%); box-shadow: 0 2px 5px black; }
        
        /* ZIPLAMA TU≈ûU (ƒ∞stenilen Stil) */
        #jump-btn { 
            position: absolute; bottom: 50px; right: 40px; width: 80px; height: 80px; 
            background: rgba(128, 128, 128, 0.4); /* Gri ≈ûeffaf */
            border-radius: 50%; border: 2px solid rgba(255,255,255,0.5); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 30px; color: white; cursor: pointer; pointer-events: auto;
            transition: background 0.1s;
        }
        #jump-btn:active { background: rgba(255, 255, 255, 0.9); color: #333; } /* Basƒ±nca Beyaz */

        #stop-hud { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 8px 20px; border-radius: 4px; cursor: pointer; pointer-events: auto; border: 2px solid white; font-weight: bold; }

        /* AI CHAT */
        #ai-modal { position: fixed; bottom: 20px; right: 20px; width: 350px; height: 400px; background: white; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: none; flex-direction: column; z-index: 2200; }
        .ai-msg { padding: 8px; margin: 5px; border-radius: 5px; font-size: 12px; }
        .ai-msg.bot { background: #f0f0f0; align-self: flex-start; } .ai-msg.user { background: #ffebee; color: var(--primary); align-self: flex-end; }

        /* ITEMS */
        .t-item { border:1px solid #eee; padding:5px; text-align:center; font-size:10px; cursor:pointer; border-radius:4px; display:flex; flex-direction:column; align-items:center; background:white; }
        .t-item:hover { border-color: var(--primary); background:#fafafa; }
        .t-preview { width: 30px; height: 30px; margin-bottom: 5px; border-radius: 3px; }
    </style>
</head>
<body onload="App.init()">

    <div id="start-screen">
        <h1>LunX Studio</h1>
        <p>AI Architect Edition</p>
        <div>
            <div class="template-card" onclick="World.load('baseplate')">‚¨ú Baseplate</div>
            <div class="template-card" onclick="World.load('grass')">üå≥ Grass</div>
            <div class="template-card" onclick="World.load('village')">üè° Village</div>
        </div>
    </div>

    <div id="top-bar">
        <div style="font-weight:bold; margin-right:20px;">LunX Studio</div>
    </div>

    <div id="ribbon">
        <div class="tool-btn active" onclick="Editor.setMode('select')"><span>üëÜ</span>Se√ß</div>
        <div class="tool-btn" onclick="Editor.setMode('translate')"><span>‚ÜîÔ∏è</span>Ta≈üƒ±</div>
        <div class="tool-btn" onclick="Editor.setMode('rotate')"><span>üîÑ</span>D√∂nd√ºr</div>
        <div style="width:1px; background:#eee; margin:0 5px;"></div>
        <div class="tool-btn" onclick="UI.toggleToolbox()"><span>üß∞</span>Toolbox</div>
        <div class="tool-btn" onclick="UI.toggleAI()"><span>ü§ñ</span>LunAIX</div>
        <div class="tool-btn" onclick="Game.play()" style="margin-left:auto; color:green; font-weight:bold;"><span>‚ñ∂</span>OYNAT</div>
    </div>

    <div id="layout">
        <div id="toolbox">
            <div style="padding:10px; font-weight:bold; background:#eee;">Toolbox <span style="float:right; cursor:pointer" onclick="UI.toggleToolbox()">x</span></div>
            <div class="tb-tabs">
                <div class="tb-tab active" onclick="UI.setTab('blocks')">Bloklar</div>
                <div class="tb-tab" onclick="UI.setTab('builds')">Builds</div>
                <div class="tb-tab" onclick="UI.setTab('effects')">Efektler</div>
            </div>
            <div id="tab-blocks" class="tb-content active"></div>
            <div id="tab-builds" class="tb-content"></div>
            <div id="tab-effects" class="tb-content"></div>
        </div>

        <div id="viewport">
            <div id="game-hud">
                <div id="stop-hud" onclick="Game.stop()">‚èπ DURDUR</div>
                <div id="joystick-zone"><div id="stick"></div></div>
                <div id="jump-btn">‚¨Ü</div>
            </div>
        </div>

        <div id="properties">
            <div style="padding:10px; font-weight:bold; background:#eee;">√ñzellikler</div>
            <div id="prop-content" style="padding:10px; font-size:12px;">Se√ßim Yok</div>
        </div>
    </div>

    <div id="ai-modal">
        <div style="background:var(--primary); color:white; padding:10px; font-weight:bold; display:flex; justify-content:space-between;">
            <span>LunAIX Architect</span> <span style="cursor:pointer" onclick="UI.toggleAI()">‚úï</span>
        </div>
        <div id="ai-chat" style="flex:1; overflow-y:auto; padding:10px;">
            <div class="ai-msg bot">Ne in≈üa edelim? "Yol yap", "Modern ev kur" veya "Ate≈ü efekti ekle" diyebilirsin.</div>
        </div>
        <div style="padding:10px; display:flex; border-top:1px solid #ddd;">
            <input type="text" id="ai-input" style="flex:1; padding:5px;" placeholder="..." onkeydown="if(event.key==='Enter')AI.send()">
            <button onclick="AI.send()" style="margin-left:5px;">G√∂nder</button>
        </div>
    </div>

    <script>
        const App = {
            scene: null, camera: null, renderer: null, controls: null, transform: null,
            world: null, clock: new THREE.Clock(), objects: [], particles: [],
            init: () => {
                const vp = document.getElementById('viewport');
                App.scene = new THREE.Scene();
                App.scene.background = new THREE.Color(0x87CEEB);
                
                App.camera = new THREE.PerspectiveCamera(60, vp.clientWidth/vp.clientHeight, 0.1, 1000);
                App.camera.position.set(15, 15, 15);

                App.renderer = new THREE.WebGLRenderer({antialias:true});
                App.renderer.setSize(vp.clientWidth, vp.clientHeight);
                App.renderer.shadowMap.enabled = true;
                vp.appendChild(App.renderer.domElement);

                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(20, 50, 20); light.castShadow = true;
                App.scene.add(light); App.scene.add(new THREE.AmbientLight(0x666));

                App.controls = new THREE.OrbitControls(App.camera, App.renderer.domElement);
                App.transform = new THREE.TransformControls(App.camera, App.renderer.domElement);
                App.transform.addEventListener('dragging-changed', e => App.controls.enabled = !e.value);
                App.scene.add(App.transform);

                App.world = new CANNON.World();
                App.world.gravity.set(0, -30, 0);

                window.addEventListener('resize', () => {
                    App.camera.aspect = vp.clientWidth/vp.clientHeight;
                    App.renderer.setSize(vp.clientWidth, vp.clientHeight);
                });

                UI.initToolbox();
                Game.initControls();
                App.loop();
            },
            loop: () => {
                requestAnimationFrame(App.loop);
                const dt = App.clock.getDelta();
                const time = Date.now() * 0.001;

                if(Game.active) {
                    App.world.step(1/60, dt, 3);
                    Game.update(dt);
                } else {
                    App.controls.update();
                }

                // Animasyonlu Su & Par√ßacƒ±klar
                App.objects.forEach(o => {
                    if(o.userData.body && !o.userData.anchored) {
                        o.position.copy(o.userData.body.position);
                        o.quaternion.copy(o.userData.body.quaternion);
                    }
                    // Su Efekti
                    if(o.userData.type === 'water') {
                        o.material.opacity = 0.6 + Math.sin(time + o.position.x)*0.1;
                    }
                });

                // Par√ßacƒ±k Sistemi (Ate≈ü/Duman)
                App.particles.forEach(p => p.update(dt));

                App.renderer.render(App.scene, App.camera);
            }
        };

        const World = {
            load: (type) => {
                document.getElementById('start-screen').style.display = 'none';
                // Temizle
                App.objects.forEach(o => { App.scene.remove(o); App.world.removeBody(o.userData.body); });
                App.objects = []; App.particles = [];

                // Zemin
                const color = type==='grass' || type==='village' ? 0x4CAF50 : 0x9E9E9E;
                const floor = World.addPart('box', {scale:[200,2,200], color:color, anchored:true, pos:new THREE.Vector3(0,-1,0)});
                floor.receiveShadow = true;

                // Spawn
                World.addPart('cylinder', {scale:[4,0.5,4], color:0x888888, anchored:true, pos:new THREE.Vector3(0,0.25,0), name:"Spawn"});

                if(type === 'village') AI.build('village');
            },

            addPart: (type, cfg={}) => {
                const scale = cfg.scale || [2,2,2];
                let geo, shape;
                if(type==='sphere') { geo = new THREE.SphereGeometry(1,32,32); shape = new CANNON.Sphere(Math.max(scale[0],scale[1])/2); }
                else if(type==='cylinder') { geo = new THREE.CylinderGeometry(1,1,1,32); shape = new CANNON.Cylinder(scale[0]/2, scale[0]/2, scale[1], 12); }
                else { geo = new THREE.BoxGeometry(1,1,1); shape = new CANNON.Box(new CANNON.Vec3(scale[0]/2, scale[1]/2, scale[2]/2)); }

                const mat = new THREE.MeshStandardMaterial({color: cfg.color||0xffffff, transparent:!!cfg.opacity, opacity:cfg.opacity||1});
                const mesh = new THREE.Mesh(geo, mat);
                mesh.scale.set(scale[0], scale[1], scale[2]);
                mesh.position.copy(cfg.pos || new THREE.Vector3(0,5,0));
                if(cfg.rot) mesh.rotation.copy(cfg.rot);
                mesh.castShadow = true; mesh.receiveShadow = true;
                mesh.userData = { anchored: cfg.anchored!==undefined?cfg.anchored:false, type:cfg.type, script:cfg.script };

                const body = new CANNON.Body({mass: mesh.userData.anchored?0:10, shape:shape});
                body.position.copy(mesh.position);
                body.quaternion.copy(mesh.quaternion);
                
                if(cfg.type === 'water') {
                    body.collisionFilterGroup = 0; // Fiziksel √ßarpƒ±≈üma yok (Phantom)
                    mesh.userData.isWater = true;
                }

                mesh.userData.body = body;
                App.world.addBody(body);
                App.scene.add(mesh);
                App.objects.push(mesh);
                return mesh;
            },

            addEffect: (type) => {
                const pos = new THREE.Vector3((Math.random()-0.5)*10, 2, (Math.random()-0.5)*10);
                if(type === 'water') {
                    World.addPart('box', {scale:[10,2,10], color:0x2196F3, opacity:0.6, anchored:true, pos:pos, type:'water'});
                } else if (type === 'fire') {
                    // Basit par√ßacƒ±k yayƒ±cƒ±
                    const emitter = {
                        update: (dt) => {
                            if(Math.random() > 0.8) {
                                const p = World.addPart('box', {scale:[0.5,0.5,0.5], color:0xFF5722, anchored:false, pos:pos.clone()});
                                p.userData.life = 1.0;
                                p.userData.update = (dt) => {
                                    p.position.y += dt * 5;
                                    p.material.opacity -= dt;
                                    p.scale.multiplyScalar(0.95);
                                    p.userData.body.position.copy(p.position); // Sync
                                    if(p.material.opacity <= 0) {
                                        App.scene.remove(p); App.world.removeBody(p.userData.body);
                                        App.particles = App.particles.filter(x => x !== p);
                                    }
                                };
                                App.particles.push(p);
                            }
                        }
                    };
                    App.particles.push(emitter);
                    // G√∂rsel taban
                    World.addPart('cylinder', {scale:[2,0.2,2], color:0x333, anchored:true, pos:pos});
                }
            }
        };

        const AI = {
            send: () => {
                const i = document.getElementById('ai-input'); const txt = i.value.trim();
                if(!txt) return;
                AI.addMsg(txt, 'user'); i.value=''; setTimeout(()=>AI.process(txt), 600);
            },
            addMsg: (t,c) => { 
                const d=document.createElement('div'); d.className='ai-msg '+c; d.innerText=t; 
                document.getElementById('ai-chat').appendChild(d); 
            },
            process: (txt) => {
                const l = txt.toLowerCase();
                let r = "";

                if(l.includes('yol') || l.includes('road')) {
                    // Varyasyonlu Yol Mantƒ±ƒüƒ±
                    const type = Math.random();
                    const pos = new THREE.Vector3((Math.random()-0.5)*20, 0.1, (Math.random()-0.5)*20);
                    if(type < 0.5) {
                        // D√ºz Yol
                        for(let i=0; i<5; i++) World.addPart('box', {scale:[6,0.1,6], pos:pos.clone().add(new THREE.Vector3(0,0,i*6)), color:0x444, anchored:true});
                        r = "D√ºz bir yol par√ßasƒ± ekledim.";
                    } else {
                        // Virajlƒ± Yol (Basit)
                        World.addPart('box', {scale:[6,0.1,6], pos:pos, color:0x444, anchored:true});
                        World.addPart('box', {scale:[6,0.1,6], pos:pos.clone().add(new THREE.Vector3(4,0.1,4)), rot:new THREE.Euler(0,0.7,0), color:0x444, anchored:true});
                        r = "Virajlƒ± bir yol yaptƒ±m.";
                    }
                } 
                else if(l.includes('ev') || l.includes('house')) {
                    AI.build('house'); r = "ƒ∞nternetteki modern ev planlarƒ±na bakarak bir ev in≈üa ettim.";
                }
                else if(l.includes('kule') || l.includes('tower')) {
                    AI.build('tower'); r = "Y√ºksek bir kule diktim.";
                }
                else if(l.includes('su') || l.includes('water')) {
                    World.addEffect('water'); r = "Animasyonlu ve y√ºz√ºlebilir su ekledim.";
                }
                else if(l.includes('ate≈ü') || l.includes('fire')) {
                    World.addEffect('fire'); r = "Ate≈ü efekti eklendi.";
                }
                else {
                    r = "Bunu tam anlamadƒ±m. 'Yol yap', 'Ev yap', 'Su ekle' diyebilirsin.";
                }
                AI.addMsg(r, 'bot');
            },
            build: (type) => {
                const p = new THREE.Vector3((Math.random()-0.5)*20, 0, (Math.random()-0.5)*20);
                if(type === 'house') {
                    World.addPart('box', {scale:[10,1,10], pos:p.clone().add(new THREE.Vector3(0,0.5,0)), color:0x795548, anchored:true}); // Zemin
                    World.addPart('box', {scale:[1,6,8], pos:p.clone().add(new THREE.Vector3(-4,3.5,0)), color:0xffffff, anchored:true}); // Duvar
                    World.addPart('box', {scale:[1,6,8], pos:p.clone().add(new THREE.Vector3(4,3.5,0)), color:0xffffff, anchored:true}); // Duvar
                    World.addPart('box', {scale:[9,6,1], pos:p.clone().add(new THREE.Vector3(0,3.5,-3.5)), color:0xffffff, anchored:true}); // Arka
                    World.addPart('box', {scale:[12,1,12], pos:p.clone().add(new THREE.Vector3(0,7,0)), color:0x333, anchored:true}); // Tavan
                }
                else if(type === 'tower') {
                    for(let i=0; i<5; i++) {
                        World.addPart('cylinder', {scale:[4,4,2], pos:p.clone().add(new THREE.Vector3(0,1+i*2,0)), color:0x607D8B, anchored:true});
                    }
                }
                else if(type === 'village') {
                    for(let i=0; i<3; i++) AI.build('house');
                }
            }
        };

        const Game = {
            active: false, player: null, body: null, inputs: {x:0,y:0},
            
            initControls: () => {
                const stick = document.getElementById('stick');
                const zone = document.getElementById('joystick-zone');
                let drag = false;
                const move = (cx,cy) => {
                    const rect = zone.getBoundingClientRect();
                    const dx = cx - (rect.left+60), dy = cy - (rect.top+60);
                    const dist = Math.min(Math.sqrt(dx*dx+dy*dy), 40);
                    const ang = Math.atan2(dy,dx);
                    const x = Math.cos(ang)*dist, y = Math.sin(ang)*dist;
                    stick.style.transform = `translate(${x}px,${y}px)`;
                    Game.inputs.x = x/40; Game.inputs.y = y/40;
                };
                zone.addEventListener('pointerdown', e=>{ drag=true; zone.setPointerCapture(e.pointerId); move(e.clientX, e.clientY); });
                zone.addEventListener('pointermove', e=>{ if(drag) move(e.clientX, e.clientY); });
                zone.addEventListener('pointerup', ()=>{ drag=false; stick.style.transform=`translate(0,0)`; Game.inputs={x:0,y:0}; });
                
                document.getElementById('jump-btn').addEventListener('pointerdown', ()=>{
                    if(Game.body && Math.abs(Game.body.velocity.y) < 0.5) Game.body.velocity.y = 18;
                    // Su i√ßindeyse y√ºzme
                    const inWater = App.objects.some(o => o.userData.isWater && Game.player.position.distanceTo(o.position) < 5);
                    if(inWater) Game.body.velocity.y = 10;
                });
            },

            play: () => {
                Game.active = true; Editor.select(null);
                document.getElementById('ribbon').style.display='none';
                document.getElementById('toolbox').style.display='none';
                document.getElementById('properties').style.display='none';
                document.getElementById('game-hud').style.display='block';
                App.controls.enablePan = false;
                
                // Spawn R6
                const rig = new THREE.Group();
                const matY = new THREE.MeshStandardMaterial({color: 0xFBC02D});
                const matB = new THREE.MeshStandardMaterial({color: 0x1976D2});
                const matG = new THREE.MeshStandardMaterial({color: 0x4CAF50});
                
                // Kafa(1), G√∂vde(2), Bacak(2) = Toplam ~5 birim
                const head = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), matY); head.position.y = 4;
                const torso = new THREE.Mesh(new THREE.BoxGeometry(2,2,1), matB); torso.position.y = 2.5;
                const la = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), matY); la.position.set(-1.5, 2.5, 0);
                const ra = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), matY); ra.position.set(1.5, 2.5, 0);
                const ll = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), matG); ll.position.set(-0.5, 0.5, 0);
                const rl = new THREE.Mesh(new THREE.BoxGeometry(1,2,1), matG); rl.position.set(0.5, 0.5, 0);
                
                rig.add(head, torso, la, ra, ll, rl);
                
                let pos = new THREE.Vector3(0,5,0);
                const sp = App.scene.getObjectByName("Spawn");
                if(sp) pos.copy(sp.position).add(new THREE.Vector3(0,3,0));

                // HITBOX (Tam Oturan)
                const body = new CANNON.Body({ mass: 50, fixedRotation: true });
                // R6 Boyutlarƒ±: Geni≈ülik ~2, Y√ºkseklik ~5. Cylinder yarƒ±√ßapƒ± 1.5, boyu 5
                body.addShape(new CANNON.Cylinder(1.2, 1.2, 5, 12), new CANNON.Vec3(0, 2.5, 0));
                body.position.copy(pos);
                body.linearDamping = 0.9;
                
                App.world.addBody(body);
                App.scene.add(rig);
                Game.player = rig; Game.body = body; Game.limbs={la,ra,ll,rl};
            },

            stop: () => {
                Game.active = false;
                document.getElementById('ribbon').style.display='flex';
                document.getElementById('game-hud').style.display='none';
                document.getElementById('properties').style.display='flex';
                if(Game.player) { App.scene.remove(Game.player); App.world.removeBody(Game.body); Game.player=null; }
                App.controls.enablePan = true; App.camera.position.set(15,15,15); App.controls.target.set(0,0,0);
            },

            update: (dt) => {
                if(!Game.player) return;
                Game.player.position.copy(Game.body.position);
                
                // Kamera Takip
                App.controls.target.copy(Game.player.position.clone().add(new THREE.Vector3(0,2,0)));
                
                // Hareket
                const speed = 20;
                const camD = new THREE.Vector3(); App.camera.getWorldDirection(camD); camD.y=0; camD.normalize();
                const camR = new THREE.Vector3(-camD.z, 0, camD.x);
                const move = new THREE.Vector3().add(camR.multiplyScalar(Game.inputs.x)).add(camD.multiplyScalar(-Game.inputs.y));
                
                if(move.length() > 0.1) {
                    move.normalize().multiplyScalar(speed);
                    Game.body.velocity.x = move.x; Game.body.velocity.z = move.z;
                    Game.player.rotation.y = Math.atan2(move.x, move.z);
                    // Animasyon
                    const t = Date.now()*0.015;
                    Game.limbs.la.rotation.x = Math.sin(t); Game.limbs.ra.rotation.x = -Math.sin(t);
                    Game.limbs.ll.rotation.x = -Math.sin(t); Game.limbs.rl.rotation.x = Math.sin(t);
                } else {
                    Game.body.velocity.x *= 0.5; Game.body.velocity.z *= 0.5;
                    Game.limbs.la.rotation.x = 0; Game.limbs.ra.rotation.x = 0;
                    Game.limbs.ll.rotation.x = 0; Game.limbs.rl.rotation.x = 0;
                }
            }
        };

        const UI = {
            initToolbox: () => {
                const add = (tabId, items) => {
                    const c = document.getElementById(tabId);
                    items.forEach(i => {
                        const d = document.createElement('div'); d.className='t-item';
                        d.innerHTML = `<div class="t-preview" style="background:${i.hex}"></div>${i.n}`;
                        d.onclick = i.act;
                        c.appendChild(d);
                    });
                };

                add('tab-blocks', [
                    {n:'Kutu', hex:'#eee', act:()=>World.addPart('box', {color:0xeeeeee, anchored:true})},
                    {n:'K√ºre', hex:'#2196F3', act:()=>World.addPart('sphere', {color:0x2196F3, anchored:false})},
                    {n:'Silindir', hex:'#FFEB3B', act:()=>World.addPart('cylinder', {color:0xFFEB3B, anchored:true})}
                ]);

                add('tab-builds', [
                    {n:'Ev', hex:'#795548', act:()=>AI.build('house')},
                    {n:'Kule', hex:'#607D8B', act:()=>AI.build('tower')},
                    {n:'Yol', hex:'#333', act:()=>AI.process('yol')}
                ]);

                add('tab-effects', [
                    {n:'Su', hex:'#03A9F4', act:()=>World.addEffect('water')},
                    {n:'Ate≈ü', hex:'#FF5722', act:()=>World.addEffect('fire')}
                ]);
            },
            setTab: (t) => {
                document.querySelectorAll('.tb-tab').forEach(e=>e.classList.remove('active'));
                document.querySelectorAll('.tb-content').forEach(e=>e.classList.remove('active'));
                event.target.classList.add('active');
                document.getElementById('tab-'+t).classList.add('active');
            },
            toggleToolbox: () => { const e=document.getElementById('toolbox'); e.style.display=e.style.display==='flex'?'none':'flex'; },
            toggleAI: () => { const e=document.getElementById('ai-modal'); e.style.display=e.style.display==='flex'?'none':'flex'; }
        };

        const Editor = {
            setMode: (m) => App.transform.setMode(m),
            select: (o) => {
                if(o && o.userData.body) { App.transform.attach(o); document.getElementById('prop-content').innerText = "Se√ßili: " + o.uuid.substr(0,5); }
                else { App.transform.detach(); document.getElementById('prop-content').innerText = "Se√ßim Yok"; }
            }
        };
    </script>
</body>
</html>
