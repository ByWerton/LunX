<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunX Profesyonel Oyun Motoru (Roblox Studio Sim√ºlasyonu)</title>
    <!-- 3D G√∂r√ºn√ºm ƒ∞√ßin three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Tailwind CSS (Aray√ºz Stilini Profesyonel Yapmak ƒ∞√ßin) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ana St√ºdyo Temasƒ± */
        body { font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background-color: #0f172a; color: #f8fafc; overflow: hidden; }
        .studio-layout { display: grid; grid-template-columns: 250px 1fr 300px; grid-template-rows: 50px 1fr 250px; height: 100vh; }
        /* Paneller */
        #toolbar { grid-area: 1 / 1 / 2 / 4; background-color: #1e293b; border-bottom: 1px solid #334155; }
        #hierarchy { grid-area: 2 / 1 / 3 / 2; background-color: #0f172a; border-right: 1px solid #334155; overflow-y: auto; }
        #canvas-container { grid-area: 2 / 2 / 3 / 3; position: relative; background-color: #2c3e50; }
        #properties { grid-area: 2 / 3 / 3 / 4; background-color: #0f172a; border-left: 1px solid #334155; overflow-y: auto; }
        #console-editor-area { grid-area: 3 / 1 / 4 / 4; background-color: #1e293b; border-top: 1px solid #334155; display: flex; }
        /* Edit√∂r ve Konsol */
        #code-editor { background-color: #1a1a1a; color: #00ff00; font-family: 'Consolas', monospace; font-size: 0.85rem; flex-grow: 1; padding: 10px; border-right: 1px solid #334155; }
        #output-log { background-color: #0b111e; color: #cbd5e1; font-family: 'Consolas', monospace; font-size: 0.75rem; overflow-y: scroll; padding: 10px; flex-grow: 1; }
        /* Log Renkleri */
        .log-error { color: #f87171; font-weight: bold; }
        .log-success { color: #34d399; font-weight: bold; }
        .log-system { color: #60a5fa; }
        .log-luau { color: #ffeb3b; }
    </style>
</head>
<body>

    <div class="studio-layout">
        <!-- 1. √úst Ara√ß √áubuƒüu (Toolbar) -->
        <div id="toolbar" class="flex items-center p-2">
            <span class="text-xl font-bold text-blue-300 mr-6">LunX 3D Studio</span>
            <button id="add-block" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-1 px-3 rounded-md transition duration-150">
                üß± Yeni Block (C++)
            </button>
            <button id="init-engine" class="ml-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded-md transition duration-150">
                ‚öôÔ∏è Motoru Ba≈ülat (Init C++)
            </button>
            <button id="run-script" class="ml-auto bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-1 px-4 rounded-lg shadow-md transition duration-150">
                ‚ñ∂Ô∏è Betiƒüi √áalƒ±≈ütƒ±r (Luau)
            </button>
        </div>

        <!-- 2. Sol Hiyerar≈üi Paneli -->
        <div id="hierarchy" class="p-2">
            <h3 class="font-semibold text-gray-400 mb-2 border-b border-gray-700 pb-1">Hiyerar≈üi (C++ Obje Listesi)</h3>
            <div id="hierarchy-list" class="text-sm space-y-1">
                <p class="text-gray-500 text-xs">Motor ba≈ülatƒ±lƒ±nca buraya objeler eklenecek...</p>
            </div>
        </div>

        <!-- 3. Ana 3D Canvas Alanƒ± -->
        <div id="canvas-container">
            <!-- Three.js Canvas buraya eklenecek -->
        </div>

        <!-- 4. Saƒü √ñzellikler (Properties) Paneli -->
        <div id="properties" class="p-2">
            <h3 class="font-semibold text-gray-400 mb-2 border-b border-gray-700 pb-1">√ñzellikler (Component'ler)</h3>
            <div id="properties-panel" class="text-sm text-gray-300">
                <p class="text-gray-500">Se√ßili Obje Yok.</p>
            </div>
        </div>

        <!-- 5. Alt Konsol ve Kod Edit√∂r√º -->
        <div id="console-editor-area">
            <textarea id="code-editor" class="w-1/2 focus:outline-none" placeholder="-- Luau Scripting: Motorun 'ExecuteScript' fonksiyonunu √ßaƒüƒ±rƒ±r.&#10;-- Roblox Studio'daki gibi C++ motoruyla etkile≈üim kurun.&#10;&#10;-- √ñrnek: ScriptedPart'ƒ±n olu≈ümasƒ±nƒ± sim√ºle eder.&#10;-- LunX.World:CreatePart('AwesomePart')&#10;if 1 == 1 then CreatePart() end"></textarea>
            <pre id="output-log" class="w-1/2"></pre>
        </div>
    </div>

    <script>
        // ==========================================================
        // LUNX STUDIO WEB ƒ∞STEMCƒ∞Sƒ∞ (JavaScript)
        // C++ Motoru ile Aray√ºz Arasƒ±ndaki K√∂pr√º
        // ==========================================================

        const outputLog = document.getElementById('output-log');
        const hierarchyList = document.getElementById('hierarchy-list');
        const canvasContainer = document.getElementById('canvas-container');

        // --- 3D SAHNE Y√ñNETƒ∞Mƒ∞ (Three.js) ---
        let scene, camera, renderer;
        let objectMap = {}; // C++ ID'lerini 3D objelerle e≈üle≈ütirir

        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000);
            camera.position.set(10, 10, 10);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
            renderer.setClearColor(0x2c3e50, 1); // Koyu Mavi/Gri
            canvasContainer.appendChild(renderer.domElement);

            // I≈üƒ±klandƒ±rma
            scene.add(new THREE.AmbientLight(0x404040, 3));
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 15, 5);
            scene.add(directionalLight);

            // Zemin (Baseplate G√∂r√ºn√ºm√º)
            const planeGeometry = new THREE.PlaneGeometry(100, 100);
            const planeMaterial = new THREE.MeshLambertMaterial({ color: 0x3d4e5f, side: THREE.DoubleSide });
            const plane = new THREE.Mesh(planeGeometry, planeMaterial);
            plane.rotation.x = Math.PI / 2;
            plane.name = "GridBaseplate";
            scene.add(plane);

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            camera.aspect = canvasContainer.clientWidth / canvasContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            // Obje animasyonlarƒ± veya kamera hareketleri buraya gelir
            renderer.render(scene, camera);
        }

        // C++'tan gelen komutla 3D obje olu≈üturma
        window.JS_Spawn3DObject = function(id, x, y, z) {
            const geometry = new THREE.BoxGeometry(2, 2, 2);
            const material = new THREE.MeshLambertMaterial({ color: Math.random() * 0xffffff });
            const block = new THREE.Mesh(geometry, material);
            block.position.set(x, y, z);
            block.userData.cppID = id;
            
            scene.add(block);
            objectMap[id] = block;
        }

        // --- MOTOR KONSOLU (JavaScript) ---

        // C++ tarafƒ±ndan √ßaƒürƒ±lan loglama fonksiyonu
        window.JS_LogOutput = function(message) {
            const now = new Date().toLocaleTimeString();
            let className = 'log-system';

            if (message.includes('HATA') || message.includes('ERROR') || message.includes('failed')) {
                className = 'log-error';
            } else if (message.includes('BA≈ûLATILIYOR') || message.includes('HAZIR')) {
                 className = 'log-success';
            } else if (message.includes('Luau')) {
                 className = 'log-luau';
            }
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="text-gray-500">[${now}]</span> <span class="${className}">${message.replace(/\n/g, '<br>')}</span>`;
            outputLog.appendChild(logEntry);
            outputLog.scrollTop = outputLog.scrollHeight; 
        };

        // --- Hƒ∞YERAR≈ûƒ∞ Y√ñNETƒ∞Mƒ∞ (JavaScript) ---

        // C++ tarafƒ±ndan √ßaƒürƒ±lan Hiyerar≈üi ekleme fonksiyonu
        window.JS_AddHierarchyItem = function(name, id) {
            // ƒ∞lk kez √ßaƒürƒ±ldƒ±ƒüƒ±nda placeholder'ƒ± temizle
            if (hierarchyList.querySelector('.text-gray-500')) {
                hierarchyList.innerHTML = '';
            }

            const div = document.createElement('div');
            div.className = 'p-1 cursor-pointer hover:bg-blue-800/50 rounded transition duration-100';
            div.textContent = `${name} (ID: ${id})`;
            div.title = `C++ Engine ID: ${id}`;
            // Se√ßme i≈ülemleri buraya entegre edilebilir
            hierarchyList.appendChild(div);
        }


        // --- Wasm Mod√ºl√º Ba≈ülatma ---

        // Bu 'Module' nesnesi, Wasm y√ºkleme s√ºrecini y√∂netir.
        var Module = {
            onRuntimeInitialized: function() {
                JS_LogOutput("<span class='log-system'>Wasm Mod√ºl√º Ba≈üarƒ±yla Y√ºklendi. C++ Engine API'leri hazƒ±r.</span>");
                // Motoru otomatik ba≈ülatmƒ±yoruz, kullanƒ±cƒ± butona basacak.
            },
            // Geleneksel C++ √ßƒ±ktƒ±larƒ±nƒ± yakalama
            print: function(text) { JS_LogOutput(`[C++ STDOUT]: ${text}`); },
            printErr: function(text) { JS_LogOutput(`[C++ STDERR]: ${text}`); }
        };

        // --- Olay Dinleyicileri ---
        
        document.getElementById('init-engine').addEventListener('click', function() {
            if (typeof Module._InitializeLunXStudio === 'function') {
                outputLog.innerHTML = '';
                // Hiyerar≈üiyi temizle
                hierarchyList.innerHTML = '<p class="text-gray-500 text-xs">Motor ba≈ülatƒ±lƒ±nca buraya objeler eklenecek...</p>';
                // 3D Sahneyi temizle
                for (const objID in objectMap) { scene.remove(objectMap[objID]); }
                objectMap = {};
                
                Module._InitializeLunXStudio();
            } else {
                JS_LogOutput("[HATA]: Wasm Mod√ºl√º Y√ºklenmedi. 'lunx_core.js' bulunamƒ±yor.");
            }
        });

        document.getElementById('run-script').addEventListener('click', function() {
            const luauCode = document.getElementById('code-editor').value;
            if (typeof Module._RunScript === 'function') {
                const codePtr = Module.allocateUTF8(luauCode);
                Module._RunScript(codePtr);
                Module._free(codePtr); 
            } else {
                JS_LogOutput("[HATA]: Wasm Motor fonksiyonu (_RunScript) hen√ºz y√ºklenmedi. L√ºtfen Motoru Ba≈ülatƒ±n.");
            }
        });

        document.getElementById('add-block').addEventListener('click', function() {
            if (typeof Module._CreateNewBlockFromUI === 'function') {
                Module._CreateNewBlockFromUI();
            } else {
                JS_LogOutput("[HATA]: C++ Foksiyonu (_CreateNewBlockFromUI) √ßaƒürƒ±lamadƒ±. Motor ba≈ülatƒ±lmadƒ±.");
            }
        });

        // Sayfa y√ºklendiƒüinde 3D sahneyi ba≈ülat
        window.onload = function() {
             init3D();

             // Wasm JavaScript Glue kodunu y√ºkle. Buradaki isimlendirme, derleme komutu ile E≈ûLE≈ûMELƒ∞Dƒ∞R.
             const script = document.createElement('script');
             script.src = 'lunx_core.js'; 
             document.body.appendChild(script);

             // Emscripten dosya yolunu belirtme (Wasm dosyasƒ±nƒ±n doƒüru y√ºklenmesi i√ßin kritik)
             Module.locateFile = function(path, prefix) {
                 return path; 
             }
             
             JS_LogOutput("LunX Studio UI hazƒ±r. Wasm motor √ßekirdeƒüi bekleniyor...");
        }
    </script>
</body>
</html>

