<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LunX Studio V11.0 - LunAIX Edition</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>

    <style>
        :root {
            --bg-app: #eef0f3;
            --bg-ribbon: #ffffff;
            --bg-panel: #f9f9f9;
            --border: #d1d1d1;
            --accent: #cc0000; /* Kƒ±rmƒ±zƒ± Tema */
            --accent-light: #ffcccc;
            --text-main: #333;
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; font-family: 'Segoe UI', Tahoma, sans-serif; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { margin: 0; overflow: hidden; background: var(--bg-app); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; }

        /* --- √úST BAR --- */
        #top-bar {
            height: 35px; background: var(--accent); color: white; display: flex; align-items: center; padding: 0 15px; font-size: 13px; justify-content: space-between;
        }
        .tab-btn {
            padding: 0 15px; height: 100%; display: flex; align-items: center; cursor: pointer; opacity: 0.8; transition: 0.2s;
        }
        .tab-btn.active { opacity: 1; background: rgba(255,255,255,0.2); font-weight: bold; border-bottom: 3px solid white; }

        /* --- RIBBON MEN√ú --- */
        #ribbon {
            height: 90px; background: var(--bg-ribbon); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 10px; gap: 10px; overflow-x: auto;
        }
        .ribbon-section { display: none; gap: 5px; height: 100%; align-items: center; }
        .ribbon-section.active { display: flex; }
        
        .tool-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-width: 60px; height: 70px; border: 1px solid transparent; border-radius: 6px;
            cursor: pointer; transition: 0.2s; color: #444; font-size: 11px;
        }
        .tool-btn:hover { background: var(--accent-light); color: var(--accent); }
        .tool-btn.active { background: #ffe6e6; border: 1px solid var(--accent); }
        .tool-btn span { font-size: 24px; margin-bottom: 5px; }

        /* --- ANA D√úZEN --- */
        #main-layout { flex: 1; display: flex; position: relative; overflow: hidden; }

        /* SOL TOOLBOX */
        #toolbox {
            width: 220px; background: var(--bg-panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; z-index: 20; transition: 0.3s;
        }
        #toolbox.closed { margin-left: -220px; }
        .panel-header { padding: 10px; background: #eee; font-weight: bold; border-bottom: 1px solid #ddd; font-size: 12px; display: flex; justify-content: space-between; }
        #toolbox-list { flex: 1; overflow-y: auto; padding: 5px; }
        .tb-item { padding: 8px; margin-bottom: 4px; background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; display: flex; align-items: center; font-size: 12px; }
        .tb-item:hover { border-color: var(--accent); background: #fffdfd; }
        .tb-color { width: 16px; height: 16px; border-radius: 3px; margin-right: 8px; border: 1px solid #ccc; }

        /* ORTA EKRAN */
        #viewport { flex: 1; position: relative; background: #87CEEB; overflow: hidden; }
        
        /* SAƒû PANEL (Responsive Scroll) */
        #right-panel {
            width: 260px; background: var(--bg-panel); border-left: 1px solid var(--border);
            display: flex; flex-direction: column; z-index: 20; height: 100%;
        }
        .panel-section { flex: 1; display: flex; flex-direction: column; min-height: 150px; overflow: hidden; border-bottom: 1px solid #ccc; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 10px; }
        
        .prop-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 11px; }
        .prop-label { width: 80px; color: #666; }
        .prop-input { flex: 1; border: 1px solid #ccc; padding: 3px; border-radius: 3px; }

        /* --- OYUN HUD & KONTROLLER --- */
        #game-hud {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: none; z-index: 50;
        }
        
        /* JOYSTICK */
        #joystick-zone {
            position: absolute; bottom: 40px; left: 40px;
            width: 120px; height: 120px;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            pointer-events: auto;
            touch-action: none; /* Mobilde kaymayƒ± √∂nler */
        }
        #joystick-stick {
            position: absolute; top: 50%; left: 50%;
            width: 50px; height: 50px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            pointer-events: none;
        }

        /* JUMP BUTTON */
        #jump-btn {
            position: absolute; bottom: 60px; right: 40px;
            width: 70px; height: 70px;
            background: rgba(204, 0, 0, 0.8);
            border-radius: 50%; border: 3px solid white;
            color: white; font-size: 24px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            pointer-events: auto; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        #jump-btn:active { transform: scale(0.95); }

        /* --- LunAIX Chat Penceresi --- */
        #lunaix-container {
            position: absolute; bottom: 20px; right: 20px; width: 300px; height: 400px;
            background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; z-index: 100; overflow: hidden;
            border: 1px solid var(--accent);
            transition: 0.3s; transform: translateY(0);
        }
        #lunaix-container.minimized { height: 40px; }
        
        #ai-header {
            background: var(--accent); color: white; padding: 10px; font-weight: bold;
            display: flex; justify-content: space-between; cursor: pointer;
            align-items: center;
        }
        #ai-messages { flex: 1; padding: 10px; overflow-y: auto; background: #f4f4f4; font-size: 12px; }
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 8px; max-width: 85%; word-wrap: break-word; }
        .msg.user { background: #e3f2fd; margin-left: auto; border-bottom-right-radius: 0; color: #333; }
        .msg.ai { background: white; border: 1px solid #ddd; border-bottom-left-radius: 0; color: #333; }
        .msg.code { font-family: monospace; background: #2d2d2d; color: #00ff00; padding: 10px; border-radius: 5px; }
        
        #ai-input-area { display: flex; padding: 5px; border-top: 1px solid #ddd; background: white; }
        #ai-input { flex: 1; border: none; padding: 8px; font-size: 12px; }
        #ai-send { background: var(--accent); color: white; border: none; padding: 0 15px; border-radius: 4px; cursor: pointer; }

    </style>
</head>
<body onload="App.init()">

    <div id="top-bar">
        <div style="font-weight: bold; display:flex; align-items:center; gap:10px;">
            <span>LunX Studio</span>
            <span style="font-size:10px; background:rgba(255,255,255,0.2); padding:2px 5px; border-radius:4px;">V11.0</span>
        </div>
        <div style="display:flex; height:100%;">
            <div class="tab-btn active" onclick="UI.tab('home')">Home</div>
            <div class="tab-btn" onclick="UI.tab('model')">Model</div>
            <div class="tab-btn" onclick="UI.tab('view')">View</div>
        </div>
    </div>

    <div id="ribbon">
        <div id="sec-home" class="ribbon-section active">
            <div class="tool-btn" onclick="Tools.mode('select')" id="t-select"><span>üëÜ</span>Se√ß</div>
            <div class="tool-btn" onclick="Tools.mode('translate')" id="t-translate"><span>‚ÜîÔ∏è</span>Ta≈üƒ±</div>
            <div class="tool-btn" onclick="Tools.mode('rotate')" id="t-rotate"><span>üîÑ</span>D√∂nd√ºr</div>
            <div class="tool-btn" onclick="Tools.mode('scale')" id="t-scale"><span>‚§¢</span>Boyut</div>
            <div style="width:1px; height:50%; background:#ccc; margin:0 5px;"></div>
            <div class="tool-btn" onclick="Game.togglePlay()">
                <span id="play-icon" style="color:green">‚ñ∂Ô∏è</span><div id="play-text">Oyna</div>
            </div>
        </div>

        <div id="sec-model" class="ribbon-section">
            <div class="tool-btn" onclick="World.addPart('box')"><span>üì¶</span>Part</div>
            <div class="tool-btn" onclick="World.addPart('sphere')"><span>‚ö™</span>K√ºre</div>
            <div class="tool-btn" onclick="World.addPart('cylinder')"><span>üõ¢Ô∏è</span>Silindir</div>
            <div class="tool-btn" onclick="World.addPart('wedge')"><span>üìê</span>Rampa</div>
            <div style="width:1px; height:50%; background:#ccc; margin:0 5px;"></div>
            <div class="tool-btn" onclick="World.env('day')"><span>‚òÄÔ∏è</span>G√ºnd√ºz</div>
            <div class="tool-btn" onclick="World.env('night')"><span>üåô</span>Gece</div>
        </div>

        <div id="sec-view" class="ribbon-section">
            <div class="tool-btn" onclick="UI.toggle('toolbox')"><span>üß∞</span>Toolbox</div>
            <div class="tool-btn" onclick="UI.toggle('right-panel')"><span>‚öôÔ∏è</span>Paneller</div>
        </div>
    </div>

    <div id="main-layout">
        
        <div id="toolbox">
            <div class="panel-header">Toolbox <span onclick="UI.toggle('toolbox')" style="cursor:pointer">‚úï</span></div>
            <div id="toolbox-list">
                </div>
        </div>

        <div id="viewport">
            <div id="game-hud">
                <div id="joystick-zone">
                    <div id="joystick-stick"></div>
                </div>
                <div id="jump-btn">‚¨Ü</div>
            </div>
        </div>

        <div id="right-panel">
            <div class="panel-section" style="flex:1;">
                <div class="panel-header">Explorer</div>
                <div id="explorer-list" class="scroll-content" style="font-size:12px;"></div>
            </div>
            <div class="panel-section" style="flex:1; border-top:2px solid #ddd;">
                <div class="panel-header">Properties</div>
                <div id="prop-list" class="scroll-content"></div>
            </div>
        </div>
        
        <div id="lunaix-container">
            <div id="ai-header" onclick="LunAIX.toggle()">
                <span>ü§ñ LunAIX <small>(Beta)</small></span>
                <span>‚ñº</span>
            </div>
            <div id="ai-messages">
                <div class="msg ai">Merhaba! Ben LunAIX. Senin i√ßin ne in≈üa edebilirim? (√ñrn: "Lego ev yap", "Kƒ±rmƒ±zƒ± araba")</div>
            </div>
            <div id="ai-input-area">
                <input type="text" id="ai-input" placeholder="Bir ≈üeyler yaz..." onkeydown="if(event.key==='Enter') LunAIX.send()">
                <button id="ai-send" onclick="LunAIX.send()">‚û§</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * LunX Studio V11.0 - Core Engine
         */
        const App = {
            scene: null, camera: null, renderer: null,
            controls: null, transform: null,
            objects: [], selected: null,
            isPlaying: false,
            
            init: () => {
                // Scene Setup
                const vp = document.getElementById('viewport');
                App.scene = new THREE.Scene();
                App.scene.background = new THREE.Color(0x87CEEB);
                App.scene.fog = new THREE.Fog(0x87CEEB, 20, 200);

                // Camera
                App.camera = new THREE.PerspectiveCamera(60, vp.clientWidth/vp.clientHeight, 0.1, 1000);
                App.camera.position.set(10, 10, 15);
                App.camera.lookAt(0,0,0);

                // Renderer
                App.renderer = new THREE.WebGLRenderer({ antialias: true, preserveDrawingBuffer: true });
                App.renderer.setSize(vp.clientWidth, vp.clientHeight);
                App.renderer.shadowMap.enabled = true;
                vp.appendChild(App.renderer.domElement);

                // Lights
                const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
                App.scene.add(hemi);
                const dir = new THREE.DirectionalLight(0xffffff, 1);
                dir.position.set(50, 100, 50);
                dir.castShadow = true;
                dir.shadow.mapSize.width = 2048; 
                dir.shadow.mapSize.height = 2048;
                App.scene.add(dir);

                // Grid & Floor
                const grid = new THREE.GridHelper(200, 50, 0x999999, 0xdddddd);
                App.scene.add(grid);
                const floorGeo = new THREE.PlaneGeometry(200, 200);
                const floorMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee });
                const floor = new THREE.Mesh(floorGeo, floorMat);
                floor.rotation.x = -Math.PI/2;
                floor.receiveShadow = true;
                floor.userData = { locked: true }; // Se√ßilemez
                App.scene.add(floor);

                // Controls
                App.controls = new THREE.OrbitControls(App.camera, App.renderer.domElement);
                App.controls.enableDamping = true;
                
                App.transform = new THREE.TransformControls(App.camera, App.renderer.domElement);
                App.transform.addEventListener('dragging-changed', e => App.controls.enabled = !e.value);
                App.transform.addEventListener('change', UI.updateProps);
                App.scene.add(App.transform);

                // Event Listeners
                window.addEventListener('resize', App.onResize);
                vp.addEventListener('pointerdown', Tools.onRaycast);
                
                // Init Modules
                UI.initToolbox();
                Game.initInput();

                // Loop
                App.animate();
            },
            onResize: () => {
                const vp = document.getElementById('viewport');
                App.camera.aspect = vp.clientWidth / vp.clientHeight;
                App.camera.updateProjectionMatrix();
                App.renderer.setSize(vp.clientWidth, vp.clientHeight);
            },
            animate: () => {
                requestAnimationFrame(App.animate);
                
                if(App.isPlaying) Game.update();
                else App.controls.update();
                
                App.renderer.render(App.scene, App.camera);
            }
        };

        /**
         * World Manager & Builder
         */
        const World = {
            materials: {
                standard: new THREE.MeshStandardMaterial({ color: 0xcc0000 }),
                lego: null // Dinamik olu≈üturulacak
            },
            
            // Lego Texture Olu≈üturucu
            createLegoTexture: (colorHex) => {
                const canvas = document.createElement('canvas');
                canvas.width = 64; canvas.height = 64;
                const ctx = canvas.getContext('2d');
                
                // Zemin rengi
                ctx.fillStyle = '#' + new THREE.Color(colorHex).getHexString();
                ctx.fillRect(0,0,64,64);
                
                // Stud (√áƒ±kƒ±ntƒ±) efekti
                ctx.fillStyle = "rgba(255,255,255,0.3)";
                ctx.beginPath(); ctx.arc(32,32, 15, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "rgba(0,0,0,0.1)";
                ctx.beginPath(); ctx.arc(34,34, 15, 0, Math.PI*2); ctx.fill();

                const tex = new THREE.CanvasTexture(canvas);
                return new THREE.MeshStandardMaterial({ map: tex, color: colorHex });
            },

            addPart: (type, opts={}) => {
                let geo;
                if(type==='box') geo = new THREE.BoxGeometry(1,1,1);
                else if(type==='sphere') geo = new THREE.SphereGeometry(0.5,32,32);
                else if(type==='cylinder') geo = new THREE.CylinderGeometry(0.5,0.5,1,32);
                else if(type==='wedge') geo = new THREE.ConeGeometry(0.5,1,4);
                
                // Stil se√ßimi (Lego veya Standart)
                let mat;
                const color = opts.color || Math.random() * 0xffffff;
                
                if(opts.style === 'lego') {
                    mat = World.createLegoTexture(color);
                } else {
                    mat = new THREE.MeshStandardMaterial({ color: color, roughness: 0.4, metalness: 0.1 });
                }

                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.copy(opts.pos || new THREE.Vector3(0, 0.5, 0));
                mesh.scale.copy(opts.scale || new THREE.Vector3(2,2,2));
                
                if(opts.style === 'lego') {
                    // Legolarƒ± grid'e oturt
                    mesh.position.x = Math.round(mesh.position.x);
                    mesh.position.z = Math.round(mesh.position.z);
                }

                mesh.castShadow = true; mesh.receiveShadow = true;
                mesh.name = opts.name || "Part_" + App.objects.length;
                
                mesh.userData = { anchored: opts.anchored ?? true, style: opts.style || 'standard' };
                
                App.scene.add(mesh);
                App.objects.push(mesh);
                UI.refreshExplorer();
                return mesh;
            },
            env: (type) => {
                if(type==='day') {
                    App.scene.background.setHex(0x87CEEB);
                    App.scene.fog.color.setHex(0x87CEEB);
                } else {
                    App.scene.background.setHex(0x111122);
                    App.scene.fog.color.setHex(0x111122);
                }
            }
        };

        /**
         * Tools & Interaction
         */
        const Tools = {
            mode: (m) => {
                if(m==='select') App.transform.detach();
                else {
                    App.transform.setMode(m);
                    if(App.selected) App.transform.attach(App.selected);
                }
                // UI G√ºncelle
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                const btn = document.getElementById('t-'+m);
                if(btn) btn.classList.add('active');
            },
            onRaycast: (e) => {
                if(App.isPlaying) return;
                if(e.target.id !== 'viewport') return;

                const rect = App.renderer.domElement.getBoundingClientRect();
                const mouse = new THREE.Vector2(
                    ((e.clientX - rect.left) / rect.width) * 2 - 1,
                    -((e.clientY - rect.top) / rect.height) * 2 + 1
                );

                const ray = new THREE.Raycaster();
                ray.setFromCamera(mouse, App.camera);
                const intersects = ray.intersectObjects(App.objects);

                if(intersects.length > 0) {
                    App.selected = intersects[0].object;
                    if(!App.selected.userData.locked) {
                        App.transform.attach(App.selected);
                        UI.updateProps();
                    }
                } else {
                    App.selected = null;
                    App.transform.detach();
                    UI.updateProps();
                }
                UI.refreshExplorer();
            }
        };

        /**
         * Game Logic & Physics (Simplified)
         */
        const Game = {
            player: null,
            input: { x:0, y:0, jump:false },
            velocity: new THREE.Vector3(),
            
            initInput: () => {
                // Joystick Logic
                const zone = document.getElementById('joystick-zone');
                const stick = document.getElementById('joystick-stick');
                let startX, startY;
                
                zone.addEventListener('touchstart', e => {
                    startX = e.touches[0].clientX; startY = e.touches[0].clientY;
                }, {passive:false});
                
                zone.addEventListener('touchmove', e => {
                    e.preventDefault();
                    const dx = e.touches[0].clientX - startX;
                    const dy = e.touches[0].clientY - startY;
                    const dist = Math.min(40, Math.sqrt(dx*dx+dy*dy));
                    const angle = Math.atan2(dy, dx);
                    
                    const tx = Math.cos(angle) * dist;
                    const ty = Math.sin(angle) * dist;
                    
                    stick.style.transform = `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px))`;
                    
                    // Normalize Input (-1 to 1)
                    Game.input.x = tx / 40;
                    Game.input.y = ty / 40;
                }, {passive:false});

                const resetJoy = () => {
                    stick.style.transform = `translate(-50%, -50%)`;
                    Game.input.x = 0; Game.input.y = 0;
                };
                zone.addEventListener('touchend', resetJoy);
                
                // Keyboard
                window.addEventListener('keydown', e => {
                    if(!App.isPlaying) return;
                    const k = e.key.toLowerCase();
                    if(k==='w') Game.input.y = -1;
                    if(k==='s') Game.input.y = 1;
                    if(k==='a') Game.input.x = -1;
                    if(k==='d') Game.input.x = 1;
                    if(k===' ') Game.input.jump = true;
                });
                window.addEventListener('keyup', e => {
                     const k = e.key.toLowerCase();
                     if(['w','s'].includes(k)) Game.input.y = 0;
                     if(['a','d'].includes(k)) Game.input.x = 0;
                     if(k===' ') Game.input.jump = false;
                });
                
                // Jump Button (Touch)
                document.getElementById('jump-btn').addEventListener('touchstart', () => Game.input.jump = true);
                document.getElementById('jump-btn').addEventListener('touchend', () => Game.input.jump = false);
            },

            togglePlay: () => {
                App.isPlaying = !App.isPlaying;
                const btnText = document.getElementById('play-text');
                const btnIcon = document.getElementById('play-icon');
                const hud = document.getElementById('game-hud');
                
                if(App.isPlaying) {
                    // START GAME
                    App.transform.detach();
                    btnText.innerText = "Durdur"; btnIcon.innerText = "‚èπÔ∏è"; btnIcon.style.color="red";
                    hud.style.display = "block";
                    
                    // Spawn Player
                    const pGeo = new THREE.CapsuleGeometry(1, 2, 4, 8);
                    const pMat = new THREE.MeshStandardMaterial({color:0x00ff00});
                    Game.player = new THREE.Mesh(pGeo, pMat);
                    Game.player.position.set(0, 5, 0);
                    App.scene.add(Game.player);
                    
                    // Camera Setup
                    App.controls.enablePan = false; 
                    App.controls.maxDistance = 20;
                    
                } else {
                    // STOP GAME
                    btnText.innerText = "Oyna"; btnIcon.innerText = "‚ñ∂Ô∏è"; btnIcon.style.color="green";
                    hud.style.display = "none";
                    
                    if(Game.player) App.scene.remove(Game.player);
                    Game.player = null;
                    App.camera.position.set(10,10,15);
                    App.camera.lookAt(0,0,0);
                    App.controls.enablePan = true;
                }
            },
            
            update: () => {
                if(!Game.player) return;
                
                // Movement Logic relative to Camera
                const speed = 0.3;
                let moveX = Game.input.x;
                let moveZ = Game.input.y;

                if(moveX !== 0 || moveZ !== 0) {
                    // Kamera a√ßƒ±sƒ±nƒ± al
                    const angle = App.controls.getAzimuthalAngle();
                    
                    // Input vekt√∂r√ºn√º kamera a√ßƒ±sƒ±na g√∂re d√∂nd√ºr
                    const fwd = new THREE.Vector3(moveX, 0, moveZ);
                    fwd.applyAxisAngle(new THREE.Vector3(0,1,0), angle);
                    
                    Game.player.position.add(fwd.multiplyScalar(speed));
                    Game.player.lookAt(Game.player.position.clone().add(fwd));
                }

                // Physics (Gravity & Jump)
                if(Game.player.position.y > 1) { // Basit zemin kontrol√º
                    Game.velocity.y -= 0.02; // Gravity
                } else {
                    Game.velocity.y = 0;
                    Game.player.position.y = 1;
                    if(Game.input.jump) Game.velocity.y = 0.5;
                }
                Game.player.position.y += Game.velocity.y;

                // Camera Follow
                const offset = new THREE.Vector3(0, 8, 12);
                offset.applyQuaternion(Game.player.quaternion); // Arkasƒ±nda kal
                // Basit orbit takip (Player'ƒ±n hafif √ºst√ºne bak)
                App.controls.target.lerp(Game.player.position, 0.1);
                // App.camera.position.lerp(Game.player.position.clone().add(new THREE.Vector3(0,10,15)), 0.05);
            }
        };

        /**
         * LunAIX - Artificial Intelligence Logic
         */
        const LunAIX = {
            toggle: () => document.getElementById('lunaix-container').classList.toggle('minimized'),
            
            send: () => {
                const inp = document.getElementById('ai-input');
                const txt = inp.value.trim();
                if(!txt) return;
                
                LunAIX.addMsg(txt, 'user');
                inp.value = '';
                
                // AI Thinking Simulation
                setTimeout(() => {
                    LunAIX.process(txt.toLowerCase());
                }, 600);
            },
            
            addMsg: (text, type) => {
                const box = document.getElementById('ai-messages');
                const d = document.createElement('div');
                d.className = `msg ${type}`;
                d.innerHTML = text;
                box.appendChild(d);
                box.scrollTop = box.scrollHeight;
            },

            process: (text) => {
                let response = "";
                let command = null;
                
                // Anahtar kelime analizi
                const isLego = text.includes("lego");
                const isRealistic = text.includes("realistik") || text.includes("ger√ßek√ßi") || text.includes("realistic");
                const style = isLego ? 'lego' : (isRealistic ? 'realistic' : 'standard');
                
                // Renk Algƒ±lama
                let color = 0xcc0000; // Default Red
                if(text.includes("mavi")) color = 0x0000ff;
                if(text.includes("ye≈üil")) color = 0x00ff00;
                if(text.includes("sarƒ±")) color = 0xffff00;
                if(text.includes("siyah")) color = 0x111111;
                if(text.includes("beyaz")) color = 0xffffff;

                if(text.includes("merhaba") || text.includes("selam")) {
                    response = "Merhaba! Ben LunAIX. Senin i√ßin ne in≈üa edebilirim?";
                }
                else if(text.includes("kod")) {
                    // Kod modu sim√ºlasyonu
                    LunAIX.addMsg(`// Script olu≈üturuluyor...\nfunction build() {\n  return "LunX Engine Active";\n}`, 'code');
                    response = "ƒ∞stediƒüin kod bloƒüu hazƒ±rlandƒ± ve sisteme entegre edildi.";
                }
                else if(text.includes("ev") || text.includes("house")) {
                    response = `Anla≈üƒ±ldƒ±, ${style} tarzƒ±nda bir ev in≈üa ediyorum.`;
                    LunAIX.buildHouse(style, color);
                }
                else if(text.includes("araba") || text.includes("car")) {
                    response = "Araba ≈üasisini indiriyorum...";
                    LunAIX.buildCar(style, color);
                }
                else if(text.includes("aƒüa√ß") || text.includes("tree")) {
                    response = "Doƒüa her zaman g√ºzeldir. Aƒüa√ß ekleniyor.";
                    LunAIX.buildTree(style);
                }
                else {
                    response = "Bunu hen√ºz tam anlamadƒ±m. 'Lego ev yap' veya 'Kƒ±rmƒ±zƒ± araba' gibi deneyebilirsin.";
                }
                
                LunAIX.addMsg(response, 'ai');
            },

            // AI Build Functions
            buildHouse: (style, color) => {
                const baseSize = style === 'lego' ? 1 : 0; // Lego ise grid snap
                
                // G√∂vde
                const wall = World.addPart('box', { 
                    pos: new THREE.Vector3(5, 2, 0), 
                    scale: new THREE.Vector3(6, 4, 6), 
                    color: color, 
                    style: style,
                    name: "AI_House_Wall"
                });
                
                // √áatƒ±
                World.addPart('wedge', {
                    pos: new THREE.Vector3(5, 5.5, 0),
                    scale: new THREE.Vector3(5, 3, 5),
                    color: 0x884422,
                    style: style,
                    name: "AI_House_Roof"
                });
            },
            
            buildCar: (style, color) => {
                const x = -5;
                // G√∂vde
                World.addPart('box', { pos: new THREE.Vector3(x, 1, 0), scale: new THREE.Vector3(4, 1, 2), color: color, style:style });
                // √úst
                World.addPart('box', { pos: new THREE.Vector3(x, 2, 0), scale: new THREE.Vector3(2, 1, 1.8), color: 0x333333, style:style });
                // Tekerler
                [ [-1.5,1], [1.5,1], [-1.5,-1], [1.5,-1] ].forEach(p => {
                    World.addPart('cylinder', { 
                        pos: new THREE.Vector3(x+p[0], 0.5, p[1]), 
                        scale: new THREE.Vector3(0.8, 0.2, 0.8), 
                        color: 0x111111, 
                        style:style 
                    }).rotation.x = Math.PI/2;
                });
            },

            buildTree: (style) => {
                // G√∂vde
                World.addPart('cylinder', { pos: new THREE.Vector3(0, 1, -5), scale: new THREE.Vector3(0.8, 3, 0.8), color: 0x5D4037, style:style });
                // Yapraklar
                World.addPart('sphere', { pos: new THREE.Vector3(0, 3.5, -5), scale: new THREE.Vector3(3, 3, 3), color: 0x2E7D32, style:style });
            }
        };

        /**
         * UI Management
         */
        const UI = {
            tab: (id) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                event.target.classList.add('active');
                document.querySelectorAll('.ribbon-section').forEach(s => s.classList.remove('active'));
                document.getElementById('sec-'+id).classList.add('active');
            },
            toggle: (id) => {
                const el = document.getElementById(id);
                if(id === 'toolbox') el.classList.toggle('closed');
                else {
                    // Saƒü panel i√ßin gizle/g√∂ster
                    el.style.display = el.style.display === 'none' ? 'flex' : 'none';
                }
            },
            
            initToolbox: () => {
                const list = document.getElementById('toolbox-list');
                const items = [
                    {n:"Red Brick", c:0xcc0000}, {n:"Grass Block", c:0x00ff00}, 
                    {n:"Blue Glass", c:0x0088ff}, {n:"Wood", c:0x8B4513},
                    {n:"Stone", c:0x888888}, {n:"Gold", c:0xffd700}
                ];
                items.forEach(i => {
                    const d = document.createElement('div'); d.className='tb-item';
                    d.innerHTML = `<div class="tb-color" style="background:#${new THREE.Color(i.c).getHexString()}"></div>${i.n}`;
                    d.onclick = () => World.addPart('box', {color:i.c, style:'lego'}); // Toolbox varsayƒ±lan lego olsun
                    list.appendChild(d);
                });
            },

            refreshExplorer: () => {
                const list = document.getElementById('explorer-list');
                list.innerHTML = '';
                App.objects.forEach(obj => {
                    const d = document.createElement('div');
                    d.style.padding="4px"; d.style.borderBottom="1px solid #eee"; d.style.cursor="pointer";
                    d.innerText = "üì¶ " + obj.name;
                    if(obj === App.selected) { d.style.background = "#cce5ff"; d.style.fontWeight="bold"; }
                    d.onclick = () => {
                        App.selected = obj;
                        if(!obj.userData.locked) App.transform.attach(obj);
                        UI.updateProps();
                        UI.refreshExplorer();
                    };
                    list.appendChild(d);
                });
            },

            updateProps: () => {
                const list = document.getElementById('prop-list');
                list.innerHTML = '';
                if(!App.selected) {
                    list.innerHTML = '<div style="padding:10px; color:#888;">Obje se√ßilmedi</div>';
                    return;
                }
                
                const addProp = (lbl, val, type, onChange) => {
                    const d = document.createElement('div'); d.className='prop-row';
                    d.innerHTML = `<div class="prop-label">${lbl}</div>`;
                    const inp = document.createElement('input'); inp.className='prop-input';
                    
                    if(type==='color') { inp.type='color'; inp.value='#'+val.getHexString(); }
                    else if(type==='vec3') { inp.type='text'; inp.value = `${val.x.toFixed(1)}, ${val.y.toFixed(1)}, ${val.z.toFixed(1)}`; }
                    else { inp.type='text'; inp.value=val; }
                    
                    inp.onchange = (e) => onChange(e.target.value);
                    d.appendChild(inp); list.appendChild(d);
                };
                
                const o = App.selected;
                addProp("ƒ∞sim", o.name, 'text', v => { o.name=v; UI.refreshExplorer(); });
                addProp("Pozisyon", o.position, 'vec3', v=>{}); // Sadece okuma ama√ßlƒ±
                addProp("Renk", o.material.color, 'color', v => o.material.color.set(v));
            }
        };

    </script>
</body>
</html>
