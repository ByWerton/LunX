<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RedWhite Studio - AI & 3D Editor</title>
    <style>
        :root {
            --primary-red: #D32F2F;
            --secondary-red: #FFEBEE;
            --dark-red: #B71C1C;
            --white: #ffffff;
            --gray: #f0f0f0;
            --border: #ccc;
            --text: #333;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--white);
            color: var(--text);
        }

        /* --- HEADER --- */
        #header {
            height: 50px;
            background-color: var(--primary-red);
            color: var(--white);
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            justify-content: space-between;
        }

        /* --- MAIN LAYOUT --- */
        #main-container {
            display: flex;
            flex: 1;
            height: calc(100% - 50px);
        }

        /* --- LEFT TOOLBOX --- */
        #toolbox {
            width: 220px;
            background-color: var(--secondary-red);
            border-right: 2px solid var(--primary-red);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .tool-category {
            padding: 10px;
            background: var(--dark-red);
            color: white;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .tool-btn {
            padding: 8px 15px;
            border: none;
            background: transparent;
            text-align: left;
            cursor: pointer;
            border-bottom: 1px solid #e0e0e0;
            transition: 0.2s;
            font-size: 13px;
            display: flex;
            align-items: center;
        }

        .tool-btn:hover {
            background-color: var(--primary-red);
            color: white;
        }
        
        .tool-btn i { margin-right: 8px; }

        /* --- CENTER CANVAS --- */
        #viewport {
            flex: 1;
            position: relative;
            background: #e0e0e0;
            overflow: hidden;
        }
        
        #ai-overlay {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            gap: 10px;
            border: 2px solid var(--primary-red);
        }

        #ai-input {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            outline: none;
        }

        #ai-btn {
            background: var(--primary-red);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        /* --- RIGHT PROPERTIES --- */
        #properties {
            width: 250px;
            background-color: var(--white);
            border-left: 2px solid var(--primary-red);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .prop-group {
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px;
            background: var(--secondary-red);
        }

        .prop-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark-red);
            border-bottom: 1px solid var(--primary-red);
            padding-bottom: 5px;
        }

        .prop-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        input[type="color"] { border: none; width: 40px; height: 25px; cursor: pointer; }
        input[type="text"], select { width: 100px; padding: 4px; }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: var(--primary-red); border-radius: 4px; }

    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="header">
        <div><span style="color: white;">RED</span>WHITE STUDIO</div>
        <div style="font-size: 12px;">Proje: ƒ∞simsiz | Mode: Edit</div>
    </div>

    <div id="main-container">
        
        <div id="toolbox">
            <div class="tool-category">Temel Ara√ßlar</div>
            <button class="tool-btn" onclick="setTransformMode('translate')">Select / Move</button>
            <button class="tool-btn" onclick="setTransformMode('scale')">Scale</button>
            <button class="tool-btn" onclick="setTransformMode('rotate')">Rotate</button>
            
            <div class="tool-category">Par√ßalar (Parts)</div>
            <button class="tool-btn" onclick="createPart('cube')">Part (K√ºp)</button>
            <button class="tool-btn" onclick="createPart('sphere')">Sphere (K√ºre)</button>
            <button class="tool-btn" onclick="createPart('cylinder')">Cylinder (Silindir)</button>
            <button class="tool-btn" onclick="createPart('plane')">Plane (Zemin)</button>
            <button class="tool-btn" onclick="create3DText()">3D Text (Yazƒ±)</button>

            <div class="tool-category">Geli≈ümi≈ü Ara√ßlar (40+)</div>
            <div id="extra-tools"></div>
        </div>

        <div id="viewport">
            <div id="ai-overlay">
                <input type="text" id="ai-input" placeholder="AI'ya yaz: 'Kƒ±rmƒ±zƒ± b√ºy√ºk kutu olu≈ütur'...">
                <button id="ai-btn" onclick="processAI()">AI G√∂nder</button>
            </div>
        </div>

        <div id="properties">
            <div class="prop-header">√ñzellikler (Properties)</div>
            
            <div id="no-selection-msg" style="color: #888; font-style: italic;">Bir obje se√ßin...</div>

            <div id="prop-content" style="display: none;">
                <div class="prop-group">
                    <div class="prop-header">G√∂r√ºn√ºm</div>
                    <div class="prop-row">
                        <span>Color:</span>
                        <input type="color" id="prop-color">
                    </div>
                    <div class="prop-row">
                        <span>Material:</span>
                        <select id="prop-material">
                            <option value="Standard">Standard</option>
                            <option value="Phong">Parlak (Phong)</option>
                            <option value="Wireframe">Tel √ñrg√º</option>
                            <option value="Toon">√áizgi Film</option>
                        </select>
                    </div>
                    <div class="prop-row">
                        <span>Opacity:</span>
                        <input type="range" id="prop-opacity" min="0" max="1" step="0.1" value="1">
                    </div>
                </div>

                <div class="prop-group">
                    <div class="prop-header">Fizik & Davranƒ±≈ü</div>
                    <div class="prop-row">
                        <span>Anchored:</span>
                        <input type="checkbox" id="prop-anchored" checked>
                    </div>
                    <div class="prop-row">
                        <span>CanCollide:</span>
                        <input type="checkbox" id="prop-collide" checked>
                    </div>
                    <div class="prop-row">
                        <span>Name:</span>
                        <input type="text" id="prop-name" value="Part">
                    </div>
                </div>

                <div class="prop-group">
                    <div class="prop-header">Transform</div>
                    <div class="prop-row">
                        <span>Pos X:</span> <span id="val-x">0</span>
                    </div>
                    <div class="prop-row">
                        <span>Pos Y:</span> <span id="val-y">0</span>
                    </div>
                    <div class="prop-row">
                        <span>Pos Z:</span> <span id="val-z">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TransformControls } from 'three/addons/controls/TransformControls.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

        // --- VARIABLES ---
        let scene, camera, renderer, controls, transformControl;
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedObject = null;
        const objects = []; // Sahnede se√ßilebilir objeler

        // --- INIT ---
        function init() {
            const container = document.getElementById('viewport');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xeeeeee);
            
            // Grid
            const gridHelper = new THREE.GridHelper(50, 50);
            scene.add(gridHelper);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(10, 20, 10);
            scene.add(dirLight);

            // Camera
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(5, 5, 10);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Orbit Controls (Camera)
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Transform Controls (Move/Rotate/Scale)
            transformControl = new TransformControls(camera, renderer.domElement);
            transformControl.addEventListener('dragging-changed', function (event) {
                controls.enabled = !event.value; // Gizmo kullanƒ±rken kamerayƒ± kilitle
            });
            transformControl.addEventListener('change', updatePropValuesUI); // Hareket edince UI g√ºncelle
            scene.add(transformControl);

            // Events
            window.addEventListener('resize', onWindowResize);
            container.addEventListener('pointerdown', onPointerDown);
            
            // UI Generate
            generateExtraTools();

            // Animation Loop
            animate();
        }

        // --- CORE FUNCTIONS ---

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.getElementById('viewport');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function createPart(type, color = 0xD32F2F, size = 1) {
            let geometry;
            if (type === 'cube') geometry = new THREE.BoxGeometry(size, size, size);
            else if (type === 'sphere') geometry = new THREE.SphereGeometry(size/2, 32, 32);
            else if (type === 'cylinder') geometry = new THREE.CylinderGeometry(size/2, size/2, size, 32);
            else if (type === 'plane') geometry = new THREE.PlaneGeometry(size*2, size*2);

            const material = new THREE.MeshStandardMaterial({ color: color });
            const mesh = new THREE.Mesh(geometry, material);
            
            mesh.position.y = size/2;
            if(type === 'plane') {
                mesh.rotation.x = -Math.PI / 2;
                mesh.position.y = 0;
            }

            // Custom Data for Roblox Logic
            mesh.userData = {
                anchored: true,
                canCollide: true,
                name: "Part",
                type: type
            };

            scene.add(mesh);
            objects.push(mesh);
            selectObject(mesh);
            return mesh;
        }

        // Text Creation
        function create3DText(textStr = "Hello") {
            const loader = new FontLoader();
            loader.load('https://unpkg.com/three@0.160.0/examples/fonts/helvetiker_regular.typeface.json', function (font) {
                const geometry = new TextGeometry(textStr, {
                    font: font,
                    size: 1,
                    height: 0.2,
                });
                geometry.center();
                const material = new THREE.MeshStandardMaterial({ color: 0xD32F2F });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.y = 1;
                
                mesh.userData = { anchored: true, canCollide: true, name: "TextPart" };
                
                scene.add(mesh);
                objects.push(mesh);
                selectObject(mesh);
            });
        }

        // Selection Logic
        function onPointerDown(event) {
            // Sadece sol tƒ±k
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(objects);

            if (intersects.length > 0) {
                // Eƒüer zaten se√ßili olana tƒ±kladƒ±ysak ve transform modundaysak bir ≈üey yapma
                if(selectedObject !== intersects[0].object) {
                    selectObject(intersects[0].object);
                }
            } else {
                // Bo≈üluƒüa tƒ±klayƒ±nca se√ßimi kaldƒ±r (Gizmo'ya tƒ±klanmadƒ±ysa)
                // Basitlik i√ßin ≈üimdilik gizmo kontrol√º yapmƒ±yoruz ama gizmo √ºstteyse raycast ona √ßarpmaz
                // selectObject(null); 
            }
        }

        function selectObject(obj) {
            selectedObject = obj;
            
            if (obj) {
                transformControl.attach(obj);
                document.getElementById('no-selection-msg').style.display = 'none';
                document.getElementById('prop-content').style.display = 'block';
                updateUIFromObject(obj);
            } else {
                transformControl.detach();
                document.getElementById('no-selection-msg').style.display = 'block';
                document.getElementById('prop-content').style.display = 'none';
            }
        }

        // --- UI & LOGIC CONNECTION ---

        // Global function exposures for HTML onclick
        window.setTransformMode = (mode) => {
            if(transformControl) transformControl.setMode(mode);
        };

        window.createPart = createPart;
        window.create3DText = () => create3DText("Text");

        // --- PROPERTIES PANEL LOGIC ---
        const propColor = document.getElementById('prop-color');
        const propMaterial = document.getElementById('prop-material');
        const propAnchored = document.getElementById('prop-anchored');
        const propCollide = document.getElementById('prop-collide');
        const propOpacity = document.getElementById('prop-opacity');

        function updateUIFromObject(obj) {
            propColor.value = '#' + obj.material.color.getHexString();
            propAnchored.checked = obj.userData.anchored;
            propCollide.checked = obj.userData.canCollide;
            
            // Materyal tipi tespiti (basit)
            if(obj.material.wireframe) propMaterial.value = "Wireframe";
            else propMaterial.value = "Standard"; 
        }

        function updatePropValuesUI() {
            if(!selectedObject) return;
            document.getElementById('val-x').innerText = selectedObject.position.x.toFixed(2);
            document.getElementById('val-y').innerText = selectedObject.position.y.toFixed(2);
            document.getElementById('val-z').innerText = selectedObject.position.z.toFixed(2);
        }

        // Listeners for Property Changes
        propColor.addEventListener('input', (e) => {
            if(selectedObject) selectedObject.material.color.set(e.target.value);
        });

        propAnchored.addEventListener('change', (e) => {
            if(selectedObject) selectedObject.userData.anchored = e.target.checked;
        });

        propCollide.addEventListener('change', (e) => {
            if(selectedObject) selectedObject.userData.canCollide = e.target.checked;
        });

        propOpacity.addEventListener('input', (e) => {
            if(selectedObject) {
                selectedObject.material.transparent = true;
                selectedObject.material.opacity = e.target.value;
            }
        });

        propMaterial.addEventListener('change', (e) => {
            if(!selectedObject) return;
            const val = e.target.value;
            const oldColor = selectedObject.material.color;
            
            let newMat;
            if(val === 'Wireframe') {
                newMat = new THREE.MeshBasicMaterial({ color: oldColor, wireframe: true });
            } else if (val === 'Phong') {
                newMat = new THREE.MeshPhongMaterial({ color: oldColor, shininess: 100 });
            } else if (val === 'Toon') {
                newMat = new THREE.MeshToonMaterial({ color: oldColor });
            } else {
                newMat = new THREE.MeshStandardMaterial({ color: oldColor });
            }
            
            selectedObject.material = newMat;
        });

        // --- SIMULATED AI LOGIC ---
        window.processAI = () => {
            const input = document.getElementById('ai-input').value.toLowerCase();
            if(!input) return;

            // Basit NLP (Doƒüal Dil ƒ∞≈üleme) Sim√ºlasyonu
            let color = 0xD32F2F;
            if(input.includes('mavi')) color = 0x2196F3;
            if(input.includes('ye≈üil')) color = 0x4CAF50;
            if(input.includes('sarƒ±')) color = 0xFFEB3B;
            if(input.includes('siyah')) color = 0x212121;
            if(input.includes('beyaz')) color = 0xffffff;

            let size = 1;
            if(input.includes('b√ºy√ºk')) size = 3;
            if(input.includes('k√º√ß√ºk')) size = 0.5;

            if(input.includes('kutu') || input.includes('k√ºp')) {
                createPart('cube', color, size);
            } else if (input.includes('k√ºre') || input.includes('top')) {
                createPart('sphere', color, size);
            } else if (input.includes('yazƒ±') || input.includes('text')) {
                // Yazƒ± i√ßeriƒüini ayƒ±kla
                const textParts = input.split(' ');
                const content = textParts.length > 1 ? textParts[textParts.length-1] : "AI";
                create3DText(content);
            } else {
                alert("AI: Tam anlayamadƒ±m ama bir kutu olu≈üturayƒ±m.");
                createPart('cube', color, size);
            }
            
            document.getElementById('ai-input').value = "";
        }

        // --- GENERATE FAKE 40+ TOOLS ---
        function generateExtraTools() {
            const list = document.getElementById('extra-tools');
            const tools = [
                "MaterialManager", "ColorAction", "Group", "Ungroup", "Lock", "Unlock", 
                "AnchorToggle", "CollisionToggle", "Join", "Separate", "Union", "Negate",
                "Script", "LocalScript", "ModuleScript", "Folder", "Model", "Tool", 
                "Accessory", "Texture", "Decal", "MeshPart", "VehicleSeat", "Seat",
                "SpawnLocation", "PointLight", "SpotLight", "SurfaceLight", "ParticleEmitter",
                "Trail", "Beam", "Fire", "Smoke", "Sparkles", "Explosion", "ForceField",
                "Sky", "Atmosphere", "Clouds", "Blur", "Bloom", "DepthOfField"
            ];

            tools.forEach(tool => {
                const btn = document.createElement('button');
                btn.className = 'tool-btn';
                btn.innerHTML = `<i>üîß</i> ${tool}`;
                btn.onclick = () => {
                    // Bazƒ± ara√ßlara fake aksiyon ekleyelim
                    if(tool === "Fire" && selectedObject) {
                         // Basit ate≈ü efekti sim√ºlasyonu (renk deƒüi≈ütirme)
                         selectedObject.material.color.setHex(0xffaa00);
                         alert("Obje ate≈üe verildi (Sim√ºlasyon)");
                    } else if (tool === "Script") {
                        alert("Script edit√∂r√º bu versiyonda aktif deƒüil.");
                    } else {
                        console.log(tool + " se√ßildi.");
                    }
                };
                list.appendChild(btn);
            });
        }

        // Start
        init();

    </script>
</body>
</html>
