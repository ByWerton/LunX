<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LunX Studio V5.0 Ultimate - Light Edition</title>
    <style>
        /* ======================================================= */
        /* ROBLOX STUDIO LIGHT THEME (BEYAZ TEMA) */
        /* ======================================================= */
        :root {
            --bg-app: #ffffff;
            --bg-ribbon: #f5f5f5;
            --bg-panel: #ffffff;
            --border-color: #dcdcdc;
            --text-main: #333333;
            --text-dim: #666666;
            --accent-blue: #00a2ff;
            --accent-hover: #e1f2ff;
            --selection-bg: #eef6ff;
            --button-hover: #e6e6e6;
            --toolbar-height: 100px; /* Ribbon tarzƒ± */
        }

        * { box-sizing: border-box; user-select: none; font-family: 'Segoe UI', Tahoma, sans-serif; }
        
        body { margin: 0; overflow: hidden; background: var(--bg-app); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; }

        /* --- BA≈ûLANGI√á EKRANI (TEMPLATE SE√áƒ∞Mƒ∞) --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f2f4f5; z-index: 9000; display: flex;
        }
        #start-sidebar {
            width: 250px; background: #ffffff; border-right: 1px solid #ddd;
            padding: 20px; display: flex; flex-direction: column; gap: 10px;
        }
        .start-btn-side {
            padding: 10px; text-align: left; background: transparent; border: none;
            font-size: 16px; color: #444; cursor: pointer; border-radius: 5px;
        }
        .start-btn-side:hover, .start-btn-side.active { background: #e1e1e1; font-weight: bold; }
        
        #start-content { flex: 1; padding: 40px; overflow-y: auto; }
        .template-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .template-card {
            background: white; border: 1px solid #ccc; border-radius: 4px;
            cursor: pointer; transition: 0.2s; display: flex; flex-direction: column;
        }
        .template-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: var(--accent-blue); }
        .template-img { height: 120px; background: #ddd; display: flex; align-items: center; justify-content: center; color: #888; font-size: 40px; }
        .template-name { padding: 10px; font-weight: bold; font-size: 14px; text-align: center; }

        /* --- EDƒ∞T√ñR ARAY√úZ√ú --- */
        #studio-interface { display: none; flex-direction: column; height: 100%; }

        /* Ribbon Toolbar */
        #ribbon-bar {
            height: var(--toolbar-height); background: var(--bg-ribbon); border-bottom: 1px solid var(--border-color);
            display: flex; align-items: flex-start; padding: 5px; gap: 5px;
        }
        .ribbon-tab-content { display: flex; gap: 15px; padding: 5px; align-items: center; }
        
        .tool-section { display: flex; flex-direction: column; align-items: center; border-right: 1px solid #ddd; padding-right: 10px; gap: 2px;}
        .section-label { font-size: 10px; color: #888; margin-top: auto; }
        
        .ribbon-btn {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: transparent; border: 1px solid transparent; border-radius: 3px;
            padding: 5px; cursor: pointer; min-width: 40px; height: 60px; color: #333;
        }
        .ribbon-btn:hover { background: var(--button-hover); border-color: #ccc; }
        .ribbon-btn.active { background: #cce8ff; border-color: var(--accent-blue); }
        .ribbon-icon { font-size: 24px; margin-bottom: 4px; }
        .ribbon-text { font-size: 11px; }

        /* Main Workspace */
        #main-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Viewport */
        #viewport-container { flex: 1; position: relative; background: #a0a0a0; }
        #viewport { width: 100%; height: 100%; outline: none; }
        
        /* Explorer & Properties (Saƒü Panel) */
        #right-panel { width: 300px; display: flex; flex-direction: column; border-left: 1px solid var(--border-color); background: var(--bg-panel); }
        
        .panel-header { 
            padding: 5px 10px; background: #f0f0f0; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;
            font-weight: bold; font-size: 12px; color: #555; display: flex; justify-content: space-between;
        }
        
        #explorer { flex: 1; overflow-y: auto; background: white; padding: 5px; font-size: 13px; }
        #properties { height: 40%; overflow-y: auto; background: white; border-top: 1px solid var(--border-color); padding: 5px; }
        
        /* Hiyerar≈üi Elemanlarƒ± */
        .tree-node { padding: 2px 5px; display: flex; align-items: center; cursor: pointer; border: 1px solid transparent; }
        .tree-node:hover { background-color: #f0f0f0; }
        .tree-node.selected { background-color: var(--selection-bg); border-color: #a0caff; }
        .node-icon { width: 16px; height: 16px; margin-right: 5px; display: inline-block; }
        
        /* Properties Tablosu */
        .prop-row { display: flex; align-items: center; margin-bottom: 4px; font-size: 12px; }
        .prop-name { width: 100px; color: #555; padding-left: 5px; }
        .prop-value { flex: 1; }
        .prop-value input { 
            width: 100%; border: 1px solid #ddd; padding: 2px 5px; font-size: 12px; border-radius: 2px; margin: 0; background: white;
        }
        .prop-value input:focus { border-color: var(--accent-blue); }

        /* Mobil / Oyun ƒ∞√ßi Kontroller */
        #game-gui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; }
        
        #menu-btn-x {
            position: absolute; top: 10px; left: 10px; width: 40px; height: 40px;
            background: rgba(30,30,30,0.8); border-radius: 50%; pointer-events: auto;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            color: white; font-weight: bold; font-family: sans-serif;
        }
        
        #ingame-settings {
            position: absolute; top: 60px; left: 10px; width: 200px; background: rgba(255,255,255,0.95);
            border-radius: 8px; padding: 10px; pointer-events: auto; display: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); border: 1px solid #ccc;
        }

        #joystick-container { position: absolute; bottom: 30px; left: 30px; width: 120px; height: 120px; pointer-events: auto; }
        #joystick-base { width: 100%; height: 100%; background: rgba(0,0,0,0.2); border-radius: 50%; position: relative; }
        #joystick-stick { width: 50px; height: 50px; background: rgba(255,255,255,0.9); border-radius: 50%; position: absolute; top: 35px; left: 35px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        
        #jump-btn { position: absolute; bottom: 40px; right: 40px; width: 70px; height: 70px; background: rgba(255,255,255,0.3); border-radius: 50%; pointer-events: auto; display: flex; align-items: center; justify-content: center; border: 2px solid white; cursor: pointer;}
        #jump-btn:active { background: rgba(255,255,255,0.6); }

        /* Script Edit√∂r√º */
        #script-editor {
            position: absolute; top: var(--toolbar-height); left: 0; right: 300px; bottom: 0;
            background: #282c34; z-index: 50; display: none; flex-direction: column;
        }
        #script-toolbar { height: 30px; background: #21252b; display: flex; align-items: center; padding: 0 10px; }
        #code-area { flex: 1; background: #282c34; color: #abb2bf; border: none; padding: 15px; font-family: 'Consolas', monospace; font-size: 14px; resize: none; outline: none; line-height: 1.5; }

    </style>
</head>
<body>

    <div id="start-screen">
        <div id="start-sidebar">
            <h2 style="color:var(--accent-blue); margin:0 0 20px 0;">LunX Studio</h2>
            <button class="start-btn-side active">Yeni</button>
            <button class="start-btn-side">Oyunlarƒ±m</button>
            <button class="start-btn-side">Son Kullanƒ±lanlar</button>
            <div style="flex:1"></div>
            <div style="font-size:11px; color:#888;">V5.0 Ultimate</div>
        </div>
        <div id="start-content">
            <h2 style="margin-top:0;">T√ºm ≈ûablonlar</h2>
            <div class="template-grid">
                <div class="template-card" onclick="LunX.start('baseplate')">
                    <div class="template-img">‚¨ú</div>
                    <div class="template-name">Baseplate</div>
                </div>
                <div class="template-card" onclick="LunX.start('flat')">
                    <div class="template-img">üü©</div>
                    <div class="template-name">Flat Terrain</div>
                </div>
                <div class="template-card" onclick="LunX.start('village')">
                    <div class="template-img">üè°</div>
                    <div class="template-name">Village</div>
                </div>
                <div class="template-card" onclick="LunX.start('obby')">
                    <div class="template-img">üèÉ</div>
                    <div class="template-name">Obby</div>
                </div>
            </div>
        </div>
    </div>

    <div id="studio-interface">
        <div id="ribbon-bar">
            <div class="tool-section">
                <div class="ribbon-tab-content">
                    <div class="ribbon-btn active" id="tool-select" onclick="LunX.tools.setMode('select')">
                        <div class="ribbon-icon">üëÜ</div><div class="ribbon-text">Se√ß</div>
                    </div>
                    <div class="ribbon-btn" id="tool-translate" onclick="LunX.tools.setMode('translate')">
                        <div class="ribbon-icon">‚ÜîÔ∏è</div><div class="ribbon-text">Ta≈üƒ±</div>
                    </div>
                    <div class="ribbon-btn" id="tool-scale" onclick="LunX.tools.setMode('scale')">
                        <div class="ribbon-icon">‚§¢</div><div class="ribbon-text">Boyut</div>
                    </div>
                    <div class="ribbon-btn" id="tool-rotate" onclick="LunX.tools.setMode('rotate')">
                        <div class="ribbon-icon">üîÑ</div><div class="ribbon-text">√áevir</div>
                    </div>
                </div>
                <div class="section-label">Ara√ßlar</div>
            </div>

            <div class="tool-section">
                <div class="ribbon-tab-content">
                    <div class="ribbon-btn" onclick="LunX.world.addPart('box')">
                        <div class="ribbon-icon">üì¶</div><div class="ribbon-text">Part</div>
                    </div>
                    <div class="ribbon-btn" onclick="LunX.world.addPart('sphere')">
                        <div class="ribbon-icon">‚ö™</div><div class="ribbon-text">Sphere</div>
                    </div>
                    <div class="ribbon-btn" onclick="LunX.world.addPart('cylinder')">
                        <div class="ribbon-icon">üõ¢Ô∏è</div><div class="ribbon-text">Cylinder</div>
                    </div>
                </div>
                <div class="section-label">Ekle</div>
            </div>

            <div class="tool-section">
                <div class="ribbon-tab-content">
                    <div class="ribbon-btn" style="color:var(--secondary-color);" onclick="LunX.game.play()">
                        <div class="ribbon-icon">‚ñ∂Ô∏è</div><div class="ribbon-text"><b>Oyna</b></div>
                    </div>
                    <div class="ribbon-btn" style="color:#d32f2f;" onclick="LunX.game.stop()">
                        <div class="ribbon-icon">‚èπÔ∏è</div><div class="ribbon-text">Durdur</div>
                    </div>
                </div>
                <div class="section-label">Test</div>
            </div>
             <div class="tool-section">
                <div class="ribbon-tab-content">
                    <div class="ribbon-btn" onclick="LunX.editor.toggleProperties()">
                         <div class="ribbon-icon">üé®</div><div class="ribbon-text">Renk</div>
                    </div>
                     <div class="ribbon-btn" onclick="LunX.editor.toggleAnchor()">
                         <div class="ribbon-icon">‚öì</div><div class="ribbon-text">Anchor</div>
                    </div>
                </div>
                 <div class="section-label">Edit</div>
            </div>
        </div>

        <div id="main-layout">
            <div id="viewport-container">
                <div id="viewport"></div>
                
                <div id="script-editor">
                    <div id="script-toolbar">
                        <button onclick="LunX.editor.closeScript()" style="background:none; border:none; color:white; cursor:pointer;">‚úñ Kapat</button>
                        <span style="color:#888; margin-left:10px;">script.lua (Sim√ºle)</span>
                    </div>
                    <textarea id="code-area"></textarea>
                </div>

                <div id="game-gui">
                    <div id="menu-btn-x" onclick="LunX.game.toggleMenu()">X</div>
                    <div id="ingame-settings">
                        <div style="font-weight: bold; margin-bottom: 10px;">Ayarlar</div>
                        <button onclick="LunX.game.resetChar()" style="width:100%; margin-bottom:5px;">Reset Character</button>
                        <div style="font-size:12px; margin-top:5px;">Kalite</div>
                        <select style="width:100%;" onchange="LunX.renderer.setQuality(this.value)">
                            <option value="high">Y√ºksek</option>
                            <option value="low">D√º≈ü√ºk</option>
                        </select>
                    </div>

                    <div id="mobile-controls">
                        <div id="joystick-container">
                            <div id="joystick-base"><div id="joystick-stick"></div></div>
                        </div>
                        <div id="jump-btn">‚¨Ü</div>
                    </div>
                </div>
            </div>

            <div id="right-panel">
                <div class="panel-header">Explorer <span style="cursor:pointer" onclick="LunX.world.addScript()">+Script</span></div>
                <div id="explorer">
                    <div class="tree-node" onclick="LunX.editor.select(null)">Workspace</div>
                </div>
                <div class="panel-header">Properties</div>
                <div id="properties">
                    <div style="color:#999; text-align:center; padding:20px;">Se√ßim Yok</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>

    <script>
        /**
         * LUNX STUDIO CORE V5.0
         */
        const LunX = {
            scene: null, camera: null, renderer: null, controls: null, transform: null,
            objects: [], selected: null, isPlaying: false,
            player: null,
            
            init: () => {
                // 3D Engine Init
                const container = document.getElementById('viewport');
                LunX.scene = new THREE.Scene();
                LunX.scene.background = new THREE.Color(0x99ccff); // Sky Blue
                LunX.scene.fog = new THREE.Fog(0x99ccff, 20, 100);

                LunX.camera = new THREE.PerspectiveCamera(60, container.clientWidth/container.clientHeight, 0.1, 1000);
                LunX.camera.position.set(10, 10, 10);
                LunX.camera.lookAt(0,0,0);

                LunX.renderer = new THREE.WebGLRenderer({ antialias: true });
                LunX.renderer.setSize(container.clientWidth, container.clientHeight);
                LunX.renderer.shadowMap.enabled = true;
                LunX.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                container.appendChild(LunX.renderer.domElement);

                // Lights
                const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
                LunX.scene.add(hemiLight);
                const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
                dirLight.position.set(20, 50, 20);
                dirLight.castShadow = true;
                dirLight.shadow.mapSize.width = 2048; 
                dirLight.shadow.mapSize.height = 2048;
                LunX.scene.add(dirLight);

                // Controls
                LunX.controls = new THREE.OrbitControls(LunX.camera, LunX.renderer.domElement);
                LunX.controls.enableDamping = true;

                LunX.transform = new THREE.TransformControls(LunX.camera, LunX.renderer.domElement);
                LunX.transform.addEventListener('dragging-changed', (e) => LunX.controls.enabled = !e.value);
                LunX.transform.addEventListener('change', () => LunX.editor.updatePropsUI());
                LunX.scene.add(LunX.transform);

                // Event Listeners
                window.addEventListener('resize', LunX.editor.onResize);
                container.addEventListener('mousedown', LunX.editor.onMouseDown);
                container.addEventListener('touchstart', LunX.editor.onTouchStart, {passive:false});
                
                // Klavye
                document.addEventListener('keydown', LunX.input.onKeyDown);
                document.addEventListener('keyup', LunX.input.onKeyUp);
                
                // Joystick Init
                LunX.input.initJoystick();

                LunX.editor.animate();
            },

            start: (template) => {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('studio-interface').style.display = 'flex';
                LunX.init();
                LunX.editor.onResize();
                
                // Baseplate
                const geo = new THREE.BoxGeometry(100, 1, 100);
                const mat = new THREE.MeshStandardMaterial({ color: 0x666666 }); // Roblox baseplate gri
                const baseplate = new THREE.Mesh(geo, mat);
                baseplate.position.y = -0.5;
                baseplate.receiveShadow = true;
                baseplate.name = "Baseplate";
                baseplate.userData = { anchored: true, locked: true };
                LunX.scene.add(baseplate);
                LunX.objects.push(baseplate);
                
                // SpawnLocation
                const spawnGeo = new THREE.BoxGeometry(4, 0.5, 4);
                const spawnMat = new THREE.MeshStandardMaterial({ color: 0xaaaaaa, map: null }); // Decal yerine renk
                const spawn = new THREE.Mesh(spawnGeo, spawnMat);
                spawn.position.set(0, 0.25, 0);
                spawn.name = "SpawnLocation";
                spawn.userData = { anchored: true, isSpawn: true };
                LunX.scene.add(spawn);
                LunX.objects.push(spawn);
                
                LunX.ui.refreshExplorer();
            },

            editor: {
                animate: () => {
                    requestAnimationFrame(LunX.editor.animate);
                    
                    if (LunX.isPlaying) {
                        LunX.game.updatePhysics();
                    } else {
                        LunX.controls.update();
                    }
                    
                    LunX.renderer.render(LunX.scene, LunX.camera);
                },
                
                onResize: () => {
                    const c = document.getElementById('viewport-container');
                    if (LunX.camera) {
                        LunX.camera.aspect = c.clientWidth / c.clientHeight;
                        LunX.camera.updateProjectionMatrix();
                        LunX.renderer.setSize(c.clientWidth, c.clientHeight);
                    }
                },
                
                onMouseDown: (e) => {
                    if (LunX.isPlaying) return;
                    const rect = LunX.renderer.domElement.getBoundingClientRect();
                    const mouse = new THREE.Vector2(
                        ((e.clientX - rect.left) / rect.width) * 2 - 1,
                        -((e.clientY - rect.top) / rect.height) * 2 + 1
                    );
                    
                    const raycaster = new THREE.Raycaster();
                    raycaster.setFromCamera(mouse, LunX.camera);
                    const intersects = raycaster.intersectObjects(LunX.objects);
                    
                    if (intersects.length > 0) {
                        LunX.editor.select(intersects[0].object);
                    } else {
                        LunX.editor.select(null);
                    }
                },

                select: (obj) => {
                    LunX.selected = obj;
                    if (obj && !obj.userData.locked) {
                        LunX.transform.attach(obj);
                    } else {
                        LunX.transform.detach();
                    }
                    LunX.ui.refreshExplorer(); // Highlight g√ºncelle
                    LunX.ui.updateProperties();
                },
                
                updatePropsUI: () => {
                    if(LunX.selected) {
                        // Input deƒüerlerini g√ºncelle (ger√ßek zamanlƒ± transform i√ßin)
                        const obj = LunX.selected;
                        // Burada DOM elemanlarƒ±nƒ± bulup deƒüerlerini g√ºncellemek gerekir
                        // Basitlik i√ßin bu √∂rnekte sadece selection deƒüi≈üince full refresh yapƒ±yoruz
                    }
                },
                
                openScript: (obj) => {
                    document.getElementById('script-editor').style.display = 'flex';
                    document.getElementById('code-area').value = obj.userData.code || 'print("Hello World")';
                    // Kaydetme mantƒ±ƒüƒ± eklenebilir
                },
                
                closeScript: () => {
                    document.getElementById('script-editor').style.display = 'none';
                },
                
                toggleAnchor: () => {
                    if(LunX.selected) {
                        LunX.selected.userData.anchored = !LunX.selected.userData.anchored;
                        LunX.ui.updateProperties();
                    }
                }
            },
            
            world: {
                addPart: (type) => {
                    let geo, mat = new THREE.MeshStandardMaterial({color:0xcccccc});
                    let name = "Part";
                    if(type=='box') { geo = new THREE.BoxGeometry(2,2,2); }
                    else if(type=='sphere') { geo = new THREE.SphereGeometry(1,32,32); name="Sphere"; }
                    else if(type=='cylinder') { geo = new THREE.CylinderGeometry(1,1,2,32); name="Cylinder"; }
                    
                    const mesh = new THREE.Mesh(geo, mat);
                    mesh.position.y = 5;
                    mesh.castShadow = true;
                    mesh.receiveShadow = true;
                    mesh.name = name;
                    mesh.userData = { anchored: false, canCollide: true };
                    
                    LunX.scene.add(mesh);
                    LunX.objects.push(mesh);
                    LunX.ui.refreshExplorer();
                    LunX.editor.select(mesh);
                },
                
                addScript: () => {
                    const script = { name: "Script", type: "script", userData: {code: 'print("Hello")'} };
                    // G√∂r√ºnmez obje, sadece explorerda
                    // Basitlik i√ßin sahneye dummy eklemiyoruz, bu yapƒ± daha karma≈üƒ±k olur.
                    alert("Script eklendi (Konsol'da √ßalƒ±≈üƒ±r)");
                }
            },
            
            tools: {
                setMode: (mode) => {
                    if(mode=='select') LunX.transform.detach();
                    else LunX.transform.setMode(mode);
                    
                    document.querySelectorAll('.ribbon-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('tool-'+mode).classList.add('active');
                }
            },

            ui: {
                refreshExplorer: () => {
                    const div = document.getElementById('explorer');
                    div.innerHTML = `<div class="tree-node" style="font-weight:bold;">Workspace</div>`;
                    
                    LunX.objects.forEach(obj => {
                        const node = document.createElement('div');
                        node.className = 'tree-node ' + (LunX.selected === obj ? 'selected' : '');
                        let icon = '‚¨ú'; // Part
                        if(obj.name === 'Baseplate') icon = 'üß±';
                        if(obj.name === 'SpawnLocation') icon = 'üö©';
                        if(obj.name === 'Dummy') icon = 'üë§';
                        
                        node.innerHTML = `<span class="node-icon">${icon}</span> ${obj.name}`;
                        node.onclick = () => LunX.editor.select(obj);
                        div.appendChild(node);
                    });
                },
                
                updateProperties: () => {
                    const div = document.getElementById('properties');
                    const obj = LunX.selected;
                    
                    if (!obj) {
                        div.innerHTML = '<div style="text-align:center; margin-top:10px; color:#999;">Nesne Se√ßilmedi</div>';
                        return;
                    }
                    
                    const colorHex = '#' + obj.material.color.getHexString();
                    const pos = obj.position;
                    const size = obj.scale; // Basitlik i√ßin scale kullanƒ±yoruz, ger√ßek boyutta geometry parameters lazƒ±m
                    
                    let html = `
                        <div class="prop-row"><div class="prop-name">Name</div><div class="prop-value"><input type="text" value="${obj.name}" onchange="LunX.selected.name=this.value; LunX.ui.refreshExplorer()"></div></div>
                        <div class="prop-row"><div class="prop-name">Color</div><div class="prop-value"><input type="color" value="${colorHex}" onchange="LunX.selected.material.color.set(this.value)"></div></div>
                        <div class="prop-row"><div class="prop-name">Position</div><div class="prop-value"><input value="${pos.x.toFixed(2)}, ${pos.y.toFixed(2)}, ${pos.z.toFixed(2)}" disabled></div></div>
                        <div class="prop-row"><div class="prop-name">Anchored</div><div class="prop-value"><input type="checkbox" ${obj.userData.anchored?'checked':''} onchange="LunX.selected.userData.anchored=this.checked"></div></div>
                        <div class="prop-row"><div class="prop-name">CanCollide</div><div class="prop-value"><input type="checkbox" ${obj.userData.canCollide!==false?'checked':''} onchange="LunX.selected.userData.canCollide=this.checked"></div></div>
                        <div class="prop-row"><div class="prop-name">Transparency</div><div class="prop-value"><input type="number" min="0" max="1" step="0.1" value="${1-obj.material.opacity}" onchange="LunX.selected.material.opacity=1-this.value; LunX.selected.material.transparent=true;"></div></div>
                    `;
                    div.innerHTML = html;
                }
            },

            game: {
                play: () => {
                    LunX.isPlaying = true;
                    LunX.editor.select(null);
                    document.getElementById('game-ui').style.display = 'block';
                    document.getElementById('mobile-controls').style.display = 'flex';
                    
                    // Kamerayƒ± ayarla
                    LunX.controls.enabled = false; // Orbit iptal
                    
                    // R6 Karakteri Olu≈ütur
                    LunX.game.spawnPlayer();
                },
                
                stop: () => {
                    LunX.isPlaying = false;
                    document.getElementById('game-ui').style.display = 'none';
                    LunX.controls.enabled = true;
                    
                    // Player sil
                    if(LunX.player) {
                        LunX.scene.remove(LunX.player);
                        LunX.player = null;
                    }
                    
                    // Kamerayƒ± resetle
                    LunX.camera.position.set(10, 10, 10);
                    LunX.camera.lookAt(0,0,0);
                },
                
                spawnPlayer: () => {
                    // Spawn noktasƒ± bul
                    const spawn = LunX.objects.find(o => o.userData.isSpawn);
                    const pos = spawn ? spawn.position.clone() : new THREE.Vector3(0,2,0);
                    pos.y += 3; // Havadan d√º≈üs√ºn
                    
                    // R6 Rig Olu≈üturma
                    const group = new THREE.Group();
                    group.name = "Dummy";
                    
                    const skin = new THREE.MeshStandardMaterial({color:0xffcc99});
                    const torsoMat = new THREE.MeshStandardMaterial({color:0x007acc}); // Mavi Ti≈ü√∂rt
                    const legMat = new THREE.MeshStandardMaterial({color:0x111111});
                    
                    // Torso (2x2x1)
                    const torso = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 1), torsoMat);
                    torso.position.y = 0;
                    group.add(torso);
                    
                    // Head (1x1x1 - Silindir)
                    const head = new THREE.Mesh(new THREE.CylinderGeometry(0.6, 0.6, 1.2, 32), skin);
                    head.position.y = 1.6;
                    group.add(head);
                    
                    // Arms (1x2x1)
                    const lArm = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), skin);
                    lArm.position.set(-1.5, 0, 0);
                    group.add(lArm);
                    const rArm = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), skin);
                    rArm.position.set(1.5, 0, 0);
                    group.add(rArm);
                    
                    // Legs (1x2x1)
                    const lLeg = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), legMat);
                    lLeg.position.set(-0.5, -2, 0);
                    group.add(lLeg);
                    const rLeg = new THREE.Mesh(new THREE.BoxGeometry(1, 2, 1), legMat);
                    rLeg.position.set(0.5, -2, 0);
                    group.add(rLeg);
                    
                    // X Logosu (Canvas Texture)
                    const canvas = document.createElement('canvas'); canvas.width=64; canvas.height=64;
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#007acc'; ctx.fillRect(0,0,64,64);
                    ctx.strokeStyle='white'; ctx.lineWidth=8;
                    ctx.beginPath(); ctx.moveTo(10,10); ctx.lineTo(54,54); ctx.moveTo(54,10); ctx.lineTo(10,54); ctx.stroke();
                    const tex = new THREE.CanvasTexture(canvas);
                    const decal = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 1.5), new THREE.MeshBasicMaterial({map:tex, transparent:true}));
                    decal.position.set(0, 0, 0.51); // Torso √∂n√º
                    torso.add(decal);
                    
                    group.position.copy(pos);
                    LunX.scene.add(group);
                    LunX.player = group;
                    LunX.playerVelocity = new THREE.Vector3(0,0,0);
                },
                
                toggleMenu: () => {
                    const m = document.getElementById('ingame-settings');
                    m.style.display = m.style.display === 'block' ? 'none' : 'block';
                },
                
                resetChar: () => {
                    if(LunX.player) {
                        const spawn = LunX.objects.find(o => o.userData.isSpawn);
                        LunX.player.position.copy(spawn ? spawn.position : new THREE.Vector3(0,5,0));
                        LunX.player.position.y += 3;
                        LunX.playerVelocity.set(0,0,0);
                    }
                    document.getElementById('ingame-settings').style.display = 'none';
                }
            },
            
            physics: {
                update: (dt) => {
                    if (!LunX.player) return;
                    const p = LunX.player;
                    
                    // Basit Fizik
                    const gravity = -30;
                    const moveSpeed = 10;
                    const jumpHeight = 15;
                    
                    LunX.playerVelocity.y += gravity * dt;
                    
                    // WASD / Joystick Input
                    let dx = 0, dz = 0;
                    if(LunX.input.fwd) dz -= 1;
                    if(LunX.input.bwd) dz += 1;
                    if(LunX.input.lft) dx -= 1;
                    if(LunX.input.rgt) dx += 1;
                    
                    // Joystick override
                    if(LunX.input.joy.x !== 0 || LunX.input.joy.y !== 0) {
                        dx = LunX.input.joy.x;
                        dz = LunX.input.joy.y;
                    }
                    
                    // Kamera Y√∂n√ºne G√∂re Hareket
                    const camDir = new THREE.Vector3();
                    LunX.camera.getWorldDirection(camDir);
                    camDir.y = 0; camDir.normalize();
                    const camRight = new THREE.Vector3(-camDir.z, 0, camDir.x);
                    
                    const moveVec = new THREE.Vector3().addScaledVector(camRight, dx).addScaledVector(camDir, -dz);
                    if(moveVec.length() > 0) {
                        moveVec.normalize().multiplyScalar(moveSpeed * dt);
                        p.position.add(moveVec);
                        p.lookAt(p.position.clone().add(moveVec)); // Karakteri d√∂nd√ºr
                    }
                    
                    // Yer Kontrol√º (Raycasting gerekebilir, ≈üimdilik zemin d√ºzlemi)
                    let groundY = 0.5; // Baseplate Y + Player Leg Offset
                    // Basit: Baseplate √ºst√ºndeysek
                    if (p.position.y + LunX.playerVelocity.y * dt < 3) { // 3 birim bacak boyu vs
                         // Zemin √ßarpƒ±≈ümasƒ± (√ßok basitle≈ütirilmi≈ü)
                         // Ger√ßek bir oyunda AABB √ßarpƒ±≈üma kutusu kullanƒ±lƒ±r
                         if(p.position.y <= 3) { // Zemin seviyesi
                             p.position.y = 3;
                             LunX.playerVelocity.y = 0;
                             LunX.player.isGrounded = true;
                         }
                    } else {
                        p.position.y += LunX.playerVelocity.y * dt;
                        LunX.player.isGrounded = false;
                    }
                    
                    // Zƒ±plama
                    if (LunX.input.jump && LunX.player.isGrounded) {
                        LunX.playerVelocity.y = jumpHeight;
                        LunX.player.isGrounded = false;
                        LunX.input.jump = false; // Trigger
                    }
                    
                    // Kamera Takibi (Third Person)
                    const targetPos = p.position.clone().add(new THREE.Vector3(0, 5, 0));
                    const offset = new THREE.Vector3(0, 5, 12); // Arkadan takip
                    // Ofset'i kameranƒ±n mevcut a√ßƒ±sƒ±na g√∂re deƒüil, karakterin arkasƒ±na sabitleyebiliriz
                    // Veya serbest kamera (OrbitControls disable olduƒüu i√ßin manuel update)
                    
                    // Basit takip: Kamerayƒ± karakterin arkasƒ±na yumu≈üak√ßa ta≈üƒ±
                    /*
                    const relativeCameraOffset = new THREE.Vector3(0, 5, 10);
                    const cameraOffset = relativeCameraOffset.applyMatrix4(p.matrixWorld);
                    LunX.camera.position.lerp(cameraOffset, 0.1);
                    LunX.camera.lookAt(p.position.clone().add(new THREE.Vector3(0,2,0)));
                    */
                   
                   // OrbitControls ile takip (Daha rahat)
                   LunX.controls.target.copy(p.position);
                   LunX.controls.update();
                   
                   // D√º≈üerse resetle
                   if(p.position.y < -50) LunX.game.resetChar();
                }
            },
            
            input: {
                onKeyDown: (e) => {
                    switch(e.code) {
                        case 'KeyW': LunX.input.fwd = 1; break;
                        case 'KeyS': LunX.input.bwd = 1; break;
                        case 'KeyA': LunX.input.lft = 1; break;
                        case 'KeyD': LunX.input.rgt = 1; break;
                        case 'Space': LunX.input.jump = true; break;
                    }
                },
                onKeyUp: (e) => {
                    switch(e.code) {
                        case 'KeyW': LunX.input.fwd = 0; break;
                        case 'KeyS': LunX.input.bwd = 0; break;
                        case 'KeyA': LunX.input.lft = 0; break;
                        case 'KeyD': LunX.input.rgt = 0; break;
                        case 'Space': LunX.input.jump = false; break;
                    }
                },
                
                initJoystick: () => {
                    const zone = document.getElementById('joystick-zone');
                    const stick = document.getElementById('joystick-stick');
                    const jump = document.getElementById('jump-btn');
                    let startX, startY;
                    
                    const handleMove = (cx, cy) => {
                        const rect = zone.getBoundingClientRect();
                        const centerX = rect.left + rect.width/2;
                        const centerY = rect.top + rect.height/2;
                        let dx = cx - centerX;
                        let dy = cy - centerY;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        const maxDist = 40;
                        
                        if (dist > maxDist) {
                            dx = (dx/dist) * maxDist;
                            dy = (dy/dist) * maxDist;
                        }
                        
                        stick.style.transform = `translate(${dx}px, ${dy}px)`;
                        LunX.input.joy.x = dx / maxDist;
                        LunX.input.joy.y = -dy / maxDist; // Y yukarƒ± pozitiftir
                    };
                    
                    const endMove = () => {
                        stick.style.transform = `translate(0,0)`;
                        LunX.input.joy.x = 0;
                        LunX.input.joy.y = 0;
                    };
                    
                    zone.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e.touches[0].clientX, e.touches[0].clientY); });
                    zone.addEventListener('touchend', endMove);
                    // Mouse desteƒüi (PC testi i√ßin)
                    let dragging = false;
                    zone.addEventListener('mousedown', () => dragging = true);
                    document.addEventListener('mousemove', (e) => { if(dragging) handleMove(e.clientX, e.clientY); });
                    document.addEventListener('mouseup', () => { dragging = false; endMove(); });
                    
                    jump.addEventListener('touchstart', (e) => { e.preventDefault(); LunX.input.jump = true; });
                    jump.addEventListener('mousedown', () => LunX.input.jump = true);
                },
                
                setup: () => {
                    // Resizer
                    const resizer = document.getElementById('resizer');
                    const sidebar = document.getElementById('sidebar');
                    let resizing = false;
                    resizer.addEventListener('mousedown', (e) => { resizing = true; });
                    document.addEventListener('mousemove', (e) => {
                        if(!resizing) return;
                        const newWidth = document.body.clientWidth - e.clientX;
                        if (newWidth > 150 && newWidth < 600) {
                            sidebar.style.width = newWidth + 'px';
                            LunX.editor.onResize();
                        }
                    });
                    document.addEventListener('mouseup', () => resizing = false);
                }
            }
        };

        // Uygulamayƒ± Ba≈ülat
        window.onload = LunX.init;

    </script>
</body>
</html>
